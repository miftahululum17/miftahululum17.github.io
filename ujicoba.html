<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Kecerdasan Berhitung</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script async data-cfasync="false" src="//thubanoa.com/1?z=8043705"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Nunito', sans-serif;
    }
    
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    @keyframes toastSlide {
      0% { transform: translateY(-100%); opacity: 0; }
      10% { transform: translateY(0); opacity: 1; }
      90% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-100%); opacity: 0; }
    }
    
    .animate-slide-in { animation: slideIn 0.5s ease-out forwards; }
    .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    .animate-pulse-btn { animation: pulse 2s infinite; }
    .animate-bounce { animation: bounce 1s infinite; }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    .animate-toast { animation: toastSlide 3s ease-in-out forwards; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-success {
      background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
    }
    
    .gradient-danger {
      background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
    }
    
    .gradient-warning {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    }
    
    .card-shadow {
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }
    
    .card-hover {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    
    .btn-reward {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .btn-reward::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }
    
    .btn-reward:hover::before {
      left: 100%;
    }
    
    .btn-reward:hover {
      box-shadow: 0 12px 35px rgba(245, 87, 108, 0.6);
      transform: translateY(-2px);
    }
    
    .btn-reward:active {
      transform: scale(0.95);
    }
    
    .btn-reward:disabled {
      background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
      box-shadow: none;
    }
    
    .input-field {
      transition: all 0.3s ease;
      background: #f9fafb;
    }
    
    .input-field:focus {
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
      background: white;
      transform: translateY(-2px);
    }
    
    .nav-item {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .nav-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: scale(1.05);
    }
    
    .progress-ring {
      transform: rotate(-90deg);
      transition: stroke-dashoffset 0.5s ease;
    }
    
    .answer-btn {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .answer-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(102, 126, 234, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.4s, height 0.4s;
    }
    
    .answer-btn:active::before {
      width: 300px;
      height: 300px;
    }
    
    .floating-emoji {
      display: inline-block;
      animation: float 3s ease-in-out infinite;
    }
    
    .stat-card {
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .stat-card:hover::after {
      opacity: 1;
    }
    
    @media (max-width: 640px) {
      .card-shadow {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }
    }
    
    @media (min-width: 768px) {
      .main-container {
        max-width: 480px;
        margin: 0 auto;
      }
    }
    
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gray-100">
  <div id="app" class="h-full flex flex-col overflow-auto"><!-- Toast Notification -->
   <div id="toast" class="fixed top-4 right-4 z-50 hidden">
    <div class="bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 animate-toast">
     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
     </svg><span id="toast-message" class="font-semibold">Anda mendapat 2 poin!</span>
    </div>
   </div><!-- Auth Screen -->
   <div id="auth-screen" class="h-full gradient-bg flex items-center justify-center p-4 overflow-auto">
    <div class="w-full max-w-md main-container">
     <div class="text-center mb-8 animate-slide-in">
      <h1 id="main-title" class="text-4xl md:text-5xl font-extrabold text-white mb-3 tracking-tight">Game Kecerdasan Berhitung</h1>
      <p id="main-subtitle" class="text-purple-200 text-lg">Selamat datang di game kecerdasan!</p>
      <div class="mt-4 flex justify-center gap-2"><span class="inline-block w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0s;"></span> <span class="inline-block w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.1s;"></span> <span class="inline-block w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span>
      </div>
     </div><!-- Login Form -->
     <div id="login-form" class="glass-effect rounded-3xl p-8 card-shadow animate-slide-in" style="animation-delay: 0.2s">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center flex items-center justify-center gap-2"><span class="text-3xl">üëã</span> <span>Masuk</span></h2>
      <form id="login-form-element" class="space-y-5">
       <div><label for="login-username" class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
         <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
         </svg> Username </label> <input type="text" id="login-username" class="input-field w-full px-5 py-4 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-base" placeholder="Masukkan username">
       </div>
       <div><label for="login-password" class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
         <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
         </svg> Password </label> <input type="password" id="login-password" class="input-field w-full px-5 py-4 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-base" placeholder="Masukkan password">
       </div>
       <p id="login-error" class="text-red-500 text-sm hidden bg-red-50 px-4 py-3 rounded-xl"></p><button type="submit" id="login-btn" class="w-full gradient-primary text-white font-bold py-4 rounded-2xl hover:opacity-90 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1 text-base"> Masuk Sekarang ‚Üí </button>
      </form>
      <div class="mt-8 text-center">
       <div class="relative mb-4">
        <div class="absolute inset-0 flex items-center">
         <div class="w-full border-t border-gray-300"></div>
        </div>
        <div class="relative flex justify-center text-sm"><span class="px-4 bg-white text-gray-500 rounded-full">atau</span>
        </div>
       </div>
       <p class="text-gray-600 mb-2">Belum punya akun?</p><button id="show-register" class="gradient-primary bg-clip-text text-transparent font-bold hover:underline text-base">Daftar Sekarang</button>
      </div>
     </div><!-- Register Form -->
     <div id="register-form" class="glass-effect rounded-3xl p-8 card-shadow hidden animate-slide-in">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center flex items-center justify-center gap-2"><span class="text-3xl">ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ</span> <span>Daftar</span></h2>
      <form id="register-form-element" class="space-y-5">
       <div><label for="register-username" class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
         <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
         </svg> Username </label> <input type="text" id="register-username" class="input-field w-full px-5 py-4 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-base" placeholder="Buat username">
       </div>
       <div><label for="register-password" class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
         <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
         </svg> Password </label> <input type="password" id="register-password" class="input-field w-full px-5 py-4 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-base" placeholder="Buat password">
       </div>
       <div><label for="register-confirm" class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
         <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
         </svg> Konfirmasi Password </label> <input type="password" id="register-confirm" class="input-field w-full px-5 py-4 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-base" placeholder="Ulangi password">
       </div>
       <p id="register-error" class="text-red-500 text-sm hidden bg-red-50 px-4 py-3 rounded-xl"></p><button type="submit" id="register-btn" class="w-full gradient-primary text-white font-bold py-4 rounded-2xl hover:opacity-90 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1 text-base"> Daftar Sekarang ‚Üí </button>
      </form>
      <div class="mt-8 text-center">
       <div class="relative mb-4">
        <div class="absolute inset-0 flex items-center">
         <div class="w-full border-t border-gray-300"></div>
        </div>
        <div class="relative flex justify-center text-sm"><span class="px-4 bg-white text-gray-500 rounded-full">atau</span>
        </div>
       </div>
       <p class="text-gray-600 mb-2">Sudah punya akun?</p><button id="show-login" class="gradient-primary bg-clip-text text-transparent font-bold hover:underline text-base">Masuk</button>
      </div>
     </div>
    </div>
   </div><!-- Maintenance Screen -->
   <div id="maintenance-screen" class="h-full gradient-bg flex items-center justify-center p-4 hidden">
    <div class="w-full max-w-md main-container text-center">
     <div class="glass-effect rounded-3xl p-8 card-shadow animate-slide-in">
      <div class="text-7xl mb-6 animate-float">
       üîß
      </div>
      <h1 class="text-4xl font-extrabold text-gray-800 mb-4">Sedang Perbaikan</h1>
      <p id="maintenance-message-display" class="text-gray-600 text-lg mb-8 leading-relaxed">Aplikasi sedang dalam perbaikan. Mohon tunggu beberapa saat lagi.</p>
      <div class="flex justify-center gap-2 mb-6"><span class="inline-block w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0s;"></span> <span class="inline-block w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0.1s;"></span> <span class="inline-block w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span>
      </div><button id="maintenance-logout-btn" class="gradient-primary text-white font-bold py-3 px-8 rounded-xl hover:opacity-90 transition-all shadow-lg"> Kembali ke Login </button>
     </div>
    </div>
   </div><!-- Dashboard Screen -->
   <div id="dashboard-screen" class="h-full flex flex-col hidden">
    <header class="gradient-bg px-4 py-5 text-white shadow-lg">
     <div class="flex items-center justify-between max-w-md mx-auto">
      <div>
       <div class="flex items-center gap-2 mb-1"><span class="text-2xl">üéØ</span>
        <h1 id="dashboard-title" class="text-xl font-extrabold">Game Kecerdasan</h1>
       </div>
       <p id="user-greeting" class="text-purple-200 text-sm font-medium">Halo, User!</p>
      </div><button id="logout-btn" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-5 py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 shadow-lg">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
       </svg><span>Keluar</span> </button>
     </div>
    </header>
    <main class="flex-1 overflow-auto p-4 bg-gray-50">
     <div class="max-w-md mx-auto"><!-- Points Display -->
      <div class="glass-effect rounded-2xl p-5 mb-6 card-shadow card-hover">
       <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-gradient-warning rounded-xl flex items-center justify-center text-2xl shadow-lg animate-pulse-btn">
          üíé
         </div>
         <div>
          <p class="text-xs text-gray-500 font-bold uppercase tracking-wide">Total Poin Anda</p>
          <p id="dashboard-points" class="text-3xl font-black bg-gradient-primary bg-clip-text text-transparent">0</p>
         </div>
        </div>
        <div class="text-right">
         <p class="text-xs text-gray-500 font-bold mb-1">Konversi</p>
         <p id="dashboard-rupiah" class="text-lg font-black text-green-600">Rp 0</p>
        </div>
       </div>
      </div><!-- Telegram Contact Button --> <a href="https://t.me/+6282226489067" target="_blank" rel="noopener noreferrer" class="fixed bottom-24 right-6 z-40 w-14 h-14 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center shadow-2xl transition-all hover:scale-110 animate-float" title="Chat Admin via Telegram">
       <svg class="w-8 h-8 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
       </svg></a> <!-- Quiz Section -->
      <div id="quiz-section" class="mb-6">
       <div class="glass-effect rounded-3xl p-6 md:p-8 card-shadow">
        <div class="text-center mb-6">
         <h2 class="text-2xl font-black text-gray-800 mb-3 flex items-center justify-center gap-2">
          <svg class="w-7 h-7 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
          </svg><span>Kuis Matematika</span></h2>
         <div id="quiz-question" class="text-4xl md:text-5xl font-black text-red-600 mb-4">
         </div>
         <div class="flex items-center justify-center gap-4 text-sm text-gray-600 font-semibold">
          <div class="flex items-center gap-1">
           <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /> <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
           </svg><span>Soal #<span id="question-number">1</span></span>
          </div>
         </div>
        </div><!-- Answer Options -->
        <div id="answer-options" class="grid grid-cols-2 gap-4 mb-4"><!-- Options will be generated by JS -->
        </div><!-- Result Feedback -->
        <div id="result-feedback" class="hidden text-center py-6 animate-slide-up">
         <div id="result-icon" class="text-6xl mb-3"></div>
         <p id="result-text" class="text-2xl font-black mb-1"></p>
         <p id="result-subtext" class="text-sm text-gray-600 font-medium"></p>
        </div><!-- Reward Button -->
        <div id="reward-section" class="hidden mt-4 animate-slide-up"><button id="reward-btn" class="w-full btn-reward text-white font-bold py-4 rounded-2xl animate-pulse-btn disabled:animate-none transition-all flex items-center justify-center gap-3 shadow-xl" disabled>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg><span id="reward-btn-text">Tonton Iklan untuk +5 Poin</span> </button>
         <p class="text-center text-gray-500 text-xs mt-2 font-medium">üí° Jawab benar untuk menonton iklan dan mendapatkan poin bonus!</p>
        </div><!-- Next Question Button --> <button id="next-btn" class="hidden w-full gradient-primary text-white font-bold py-4 rounded-2xl hover:opacity-90 transition-all mt-4 shadow-lg flex items-center justify-center gap-2"> <span>Soal Berikutnya</span>
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
         </svg></button>
       </div>
      </div>
     </div>
    </main><!-- Bottom Navigation -->
    <nav class="bg-white border-t-2 border-gray-100 px-4 py-3 shadow-2xl">
     <div class="flex justify-around max-w-md mx-auto"><button class="nav-item active flex flex-col items-center px-6 py-3 rounded-2xl" data-page="quiz">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
       </svg><span class="text-xs mt-1.5 font-black">Kuis</span> </button> <button class="nav-item flex flex-col items-center px-6 py-3 rounded-2xl text-gray-500" data-page="points">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg><span class="text-xs mt-1.5 font-black">Poinku</span> </button> <button class="nav-item flex flex-col items-center px-6 py-3 rounded-2xl text-gray-500" data-page="admin" id="admin-nav-btn" style="display: none;">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
       </svg><span class="text-xs mt-1.5 font-black">Admin</span> </button>
     </div>
    </nav>
   </div><!-- Points Screen -->
   <div id="points-screen" class="h-full flex flex-col hidden">
    <header class="gradient-bg px-4 py-5 text-white shadow-lg">
     <div class="flex items-center justify-between max-w-md mx-auto">
      <div>
       <div class="flex items-center gap-2 mb-1"><span class="text-2xl">üí∞</span>
        <h1 class="text-xl font-extrabold">Poinku</h1>
       </div>
       <p id="points-user-greeting" class="text-purple-200 text-sm font-medium">Halo, User!</p>
      </div><button id="points-logout-btn" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-5 py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 shadow-lg">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
       </svg><span>Keluar</span> </button>
     </div>
    </header>
    <main class="flex-1 overflow-auto p-4 bg-gray-50">
     <div class="max-w-md mx-auto">
      <div class="glass-effect rounded-3xl p-8 card-shadow text-center mb-6 card-hover">
       <div class="w-40 h-40 mx-auto mb-6 relative animate-float">
        <svg class="w-40 h-40 progress-ring"><circle cx="80" cy="80" r="70" stroke="#e5e7eb" stroke-width="10" fill="none" /> <circle id="progress-circle" cx="80" cy="80" r="70" stroke="url(#gradient)" stroke-width="10" fill="none" stroke-linecap="round" stroke-dasharray="440" stroke-dashoffset="440" /> <defs>
          <lineargradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
           <stop offset="0%" stop-color="#667eea" />
           <stop offset="100%" stop-color="#764ba2" />
          </lineargradient>
         </defs>
        </svg>
        <div class="absolute inset-0 flex items-center justify-center">
         <div><span id="total-points" class="text-5xl font-black text-purple-600">0</span>
          <p class="text-sm text-gray-600 font-bold mt-1">Poin</p>
         </div>
        </div>
       </div>
       <h2 class="text-2xl font-black text-gray-800 mb-2">Total Poin Anda</h2>
       <p class="text-gray-600 font-medium mb-6">Terus mainkan kuis untuk mengumpulkan poin!</p><button id="withdraw-btn" class="w-full gradient-success text-white font-bold py-4 rounded-2xl hover:opacity-90 transition-all shadow-lg flex items-center justify-center gap-3">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg><span>Tarik ke Saldo DANA</span> </button>
      </div><!-- Chat Admin Button --> <a href="https://t.me/+6282226489067" target="_blank" rel="noopener noreferrer" class="block mb-6">
       <div class="glass-effect rounded-2xl p-4 card-shadow card-hover border-2 border-blue-200 hover:border-blue-400 transition-all">
        <div class="flex items-center justify-between">
         <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center shadow-lg">
           <svg class="w-7 h-7 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
           </svg>
          </div>
          <div>
           <p class="text-sm font-bold text-gray-800 flex items-center gap-2">üí¨ Chat Admin via Telegram</p>
           <p class="text-xs text-gray-600">Butuh bantuan? Hubungi kami!</p>
          </div>
         </div>
         <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
         </svg>
        </div>
       </div></a>
      <div class="space-y-4">
       <h3 class="text-xl font-black text-gray-800 flex items-center gap-2 px-2">
        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /> <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
        </svg> Riwayat Penarikan</h3>
       <div id="withdrawal-list" class="space-y-3"></div>
      </div>
     </div>
    </main>
    <nav class="bg-white border-t-2 border-gray-100 px-4 py-3 shadow-2xl">
     <div class="flex justify-around max-w-md mx-auto"><button class="nav-item flex flex-col items-center px-6 py-3 rounded-2xl text-gray-500" data-page="quiz">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
       </svg><span class="text-xs mt-1.5 font-black">Kuis</span> </button> <button class="nav-item active flex flex-col items-center px-6 py-3 rounded-2xl" data-page="points">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg><span class="text-xs mt-1.5 font-black">Poinku</span> </button> <button class="nav-item flex flex-col items-center px-6 py-3 rounded-2xl text-gray-500" data-page="admin" id="admin-nav-btn-2" style="display: none;">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
       </svg><span class="text-xs mt-1.5 font-black">Admin</span> </button>
     </div>
    </nav>
   </div><!-- Admin Screen -->
   <div id="admin-screen" class="h-full flex flex-col hidden">
    <header class="gradient-bg px-4 py-5 text-white shadow-lg">
     <div class="flex items-center justify-between max-w-4xl mx-auto">
      <div>
       <div class="flex items-center gap-2 mb-1"><span class="text-2xl">‚öôÔ∏è</span>
        <h1 class="text-xl font-extrabold">Panel Admin</h1>
       </div>
       <p id="admin-user-greeting" class="text-purple-200 text-sm font-medium">Halo, Admin!</p>
      </div><button id="admin-logout-btn" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-5 py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 shadow-lg">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
       </svg><span>Keluar</span> </button>
     </div>
    </header>
    <main class="flex-1 overflow-auto p-4 bg-gray-50">
     <div class="max-w-4xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div class="glass-effect rounded-2xl p-5 card-shadow stat-card">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center text-2xl shadow-lg">
          üë•
         </div>
         <div>
          <p class="text-xs text-gray-500 font-bold uppercase">Total User</p>
          <p id="stat-users" class="text-2xl font-black text-gray-800">0</p>
         </div>
        </div>
       </div>
       <div class="glass-effect rounded-2xl p-5 card-shadow stat-card">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-gradient-warning rounded-xl flex items-center justify-center text-2xl shadow-lg">
          üíé
         </div>
         <div>
          <p class="text-xs text-gray-500 font-bold uppercase">Total Poin</p>
          <p id="stat-points" class="text-2xl font-black text-gray-800">0</p>
         </div>
        </div>
       </div>
       <div class="glass-effect rounded-2xl p-5 card-shadow stat-card">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-gradient-success rounded-xl flex items-center justify-center text-2xl shadow-lg">
          üí∞
         </div>
         <div>
          <p class="text-xs text-gray-500 font-bold uppercase">Penarikan</p>
          <p id="stat-withdrawals" class="text-2xl font-black text-gray-800">0</p>
         </div>
        </div>
       </div>
      </div><!-- Reward Points Setting Card -->
      <div class="glass-effect rounded-3xl p-6 card-shadow mb-6">
       <h3 class="text-xl font-black text-gray-800 flex items-center gap-2 mb-4">
        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg> Pengaturan Poin Reward</h3>
       <div class="bg-purple-50 border-2 border-purple-300 rounded-xl p-4 mb-4">
        <p class="text-sm text-purple-800 mb-2"><strong>üéÅ Poin Reward:</strong> Atur jumlah poin yang didapat user setelah menonton iklan reward.</p>
        <div class="flex items-center gap-2"><span class="text-sm font-bold text-gray-700">Poin Saat Ini:</span> <span id="current-reward-points" class="px-3 py-1 rounded-lg bg-purple-500 text-white text-sm font-bold">5 Poin</span>
        </div>
       </div>
       <div class="mb-4"><label class="block text-sm font-bold text-gray-700 mb-2">Jumlah Poin Reward</label> <input type="number" id="reward-points-input" min="1" max="100" value="5" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none" placeholder="Masukkan jumlah poin (1-100)">
        <p class="text-xs text-gray-500 mt-1">üí° Rentang yang disarankan: 1-20 poin per reward</p>
       </div><button id="save-reward-points-btn" class="w-full gradient-primary text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg> Simpan Pengaturan Reward </button>
      </div><!-- Maintenance Mode Card -->
      <div class="glass-effect rounded-3xl p-6 card-shadow mb-6">
       <h3 class="text-xl font-black text-gray-800 flex items-center gap-2 mb-4">
        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
        </svg> Mode Perbaikan</h3>
       <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 mb-4">
        <p class="text-sm text-yellow-800 mb-2"><strong>ÔøΩÔøΩÔøΩÔøΩÔøΩ Mode Perbaikan:</strong> Saat aktif, semua user (kecuali admin) akan melihat halaman perbaikan setelah login.</p>
        <div class="flex items-center gap-2"><span class="text-sm font-bold text-gray-700">Status:</span> <span id="maintenance-status-badge" class="px-3 py-1 rounded-lg bg-green-500 text-white text-xs font-bold">Nonaktif</span>
        </div>
       </div>
       <div class="mb-4"><label class="block text-sm font-bold text-gray-700 mb-2">Pesan Perbaikan</label> <textarea id="maintenance-message-input" rows="3" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none resize-none" placeholder="Contoh: Aplikasi sedang dalam perbaikan. Mohon tunggu beberapa saat lagi.">Aplikasi sedang dalam perbaikan. Mohon tunggu beberapa saat lagi.</textarea>
       </div>
       <div class="flex gap-3"><button id="activate-maintenance-btn" class="flex-1 gradient-warning text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg flex items-center justify-center gap-2">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
         </svg> Aktifkan Mode Perbaikan </button> <button id="deactivate-maintenance-btn" class="flex-1 gradient-success text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg flex items-center justify-center gap-2" style="display: none;">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg> Nonaktifkan Mode Perbaikan </button>
       </div>
      </div>
      <div class="glass-effect rounded-3xl p-6 card-shadow mb-6">
       <h3 class="text-xl font-black text-gray-800 flex items-center gap-2 mb-4">
        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
        </svg> Kelola User</h3>
       <div id="admin-user-list" class="space-y-3"></div>
      </div>
      <div class="glass-effect rounded-3xl p-6 card-shadow">
       <h3 class="text-xl font-black text-gray-800 flex items-center gap-2 mb-4">
        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
        </svg> Kelola Penarikan</h3>
       <div id="admin-withdrawal-list" class="space-y-3"></div>
      </div>
     </div>
    </main>
    <nav class="bg-white border-t-2 border-gray-100 px-4 py-3 shadow-2xl">
     <div class="flex justify-around max-w-md mx-auto"><button class="nav-item flex flex-col items-center px-6 py-3 rounded-2xl text-gray-500" data-page="quiz">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
       </svg><span class="text-xs mt-1.5 font-black">Kuis</span> </button> <button class="nav-item flex flex-col items-center px-6 py-3 rounded-2xl text-gray-500" data-page="points">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg><span class="text-xs mt-1.5 font-black">Poinku</span> </button> <button class="nav-item active flex flex-col items-center px-6 py-3 rounded-2xl" data-page="admin">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
       </svg><span class="text-xs mt-1.5 font-black">Admin</span> </button>
     </div>
    </nav>
   </div><!-- Edit User Modal -->
   <div id="edit-user-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-effect rounded-3xl p-6 md:p-8 max-w-md w-full card-shadow animate-slide-up">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-black text-gray-800 flex items-center gap-2">
       <svg class="w-7 h-7 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
       </svg> Edit User</h3><button id="close-edit-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div class="space-y-5">
      <div><label class="block text-sm font-bold text-gray-700 mb-2">Username</label> <input type="text" id="edit-username" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none">
      </div>
      <div><label class="block text-sm font-bold text-gray-700 mb-2">Password Baru (kosongkan jika tidak diubah)</label> <input type="password" id="edit-password" placeholder="Masukkan password baru" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none">
      </div>
      <div><label class="block text-sm font-bold text-gray-700 mb-2">Poin</label> <input type="number" id="edit-points" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none">
      </div>
      <div class="bg-gray-50 rounded-xl p-4 border-2 border-gray-200"><label class="flex items-center gap-3 cursor-pointer"> <input type="checkbox" id="edit-blocked" class="w-5 h-5 rounded border-gray-300 text-red-600 focus:ring-red-500 focus:ring-offset-0 cursor-pointer">
        <div><span class="block text-sm font-bold text-gray-700">Blokir User</span> <span class="block text-xs text-gray-500">User yang diblokir tidak dapat login</span>
        </div></label>
      </div>
      <div class="flex gap-3 pt-2"><button id="cancel-edit-btn" class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-300 transition-all"> Batal </button> <button id="save-edit-btn" class="flex-1 gradient-primary text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg"> Simpan </button>
      </div>
     </div>
    </div>
   </div><!-- Delete User Confirmation Modal -->
   <div id="delete-user-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-effect rounded-3xl p-6 md:p-8 max-w-md w-full card-shadow animate-slide-up">
     <div class="text-center mb-6">
      <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
       <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
       </svg>
      </div>
      <h3 class="text-2xl font-black text-gray-800 mb-2">Hapus User?</h3>
      <p class="text-gray-600">Apakah Anda yakin ingin menghapus user <strong id="delete-username"></strong>? Tindakan ini tidak dapat dibatalkan.</p>
     </div>
     <div class="flex gap-3"><button id="cancel-delete-btn" class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-300 transition-all"> Batal </button> <button id="confirm-delete-btn" class="flex-1 gradient-danger text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg"> Hapus </button>
     </div>
    </div>
   </div><!-- Withdrawal Modal -->
   <div id="withdrawal-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-effect rounded-3xl p-6 md:p-8 max-w-md w-full card-shadow animate-slide-up">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-black text-gray-800 flex items-center gap-2">
       <svg class="w-7 h-7 text-green-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
       </svg> Tarik Poin</h3><button id="close-withdrawal-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="withdrawal-form" class="space-y-5">
      <div><label class="block text-sm font-bold text-gray-700 mb-2">Jumlah Poin</label> <input type="number" id="withdrawal-amount" min="50" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none" placeholder="Minimal Rp 50">
       <p class="text-xs text-gray-500 mt-1">Konversi: 1 poin = Rp 1 | Minimal penarikan: Rp 50</p>
      </div>
      <div><label class="block text-sm font-bold text-gray-700 mb-2">Nomor DANA</label> <input type="tel" id="withdrawal-phone" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none" placeholder="08xxxxxxxxxx">
      </div>
      <p id="withdrawal-error" class="text-red-500 text-sm hidden bg-red-50 px-4 py-3 rounded-xl"></p>
      <div class="flex gap-3 pt-2"><button type="button" id="cancel-withdrawal-btn" class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-300 transition-all"> Batal </button> <button type="submit" class="flex-1 gradient-success text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg"> Tarik Sekarang </button>
      </div>
     </form>
    </div>
   </div><!-- Withdrawal Detail Modal (Admin) -->
   <div id="withdrawal-detail-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-effect rounded-3xl p-6 md:p-8 max-w-md w-full card-shadow animate-slide-up">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-black text-gray-800 flex items-center gap-2">
       <svg class="w-7 h-7 text-purple-600" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
       </svg> Detail Penarikan</h3><button id="close-withdrawal-detail-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
       <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div class="space-y-4 mb-6">
      <div class="bg-gray-50 rounded-xl p-4">
       <p class="text-sm text-gray-600 mb-1">Username</p>
       <p id="detail-username" class="text-lg font-bold text-gray-800">-</p>
      </div>
      <div class="bg-gray-50 rounded-xl p-4">
       <p class="text-sm text-gray-600 mb-1">Jumlah</p>
       <p id="detail-amount" class="text-lg font-bold text-gray-800">-</p>
      </div>
      <div class="bg-gray-50 rounded-xl p-4">
       <p class="text-sm text-gray-600 mb-1">Nomor DANA</p>
       <p id="detail-phone" class="text-lg font-bold text-gray-800">-</p>
      </div>
      <div class="bg-gray-50 rounded-xl p-4">
       <p class="text-sm text-gray-600 mb-1">Waktu Penarikan</p>
       <p id="detail-date" class="text-sm font-medium text-gray-800">-</p>
      </div>
     </div>
     <div class="space-y-4">
      <div><label class="block text-sm font-bold text-gray-700 mb-2">Catatan Admin</label> <textarea id="admin-note-input" rows="3" class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none resize-none" placeholder="Tambahkan catatan (opsional)"></textarea>
      </div>
      <div class="flex gap-3"><button id="reject-withdrawal-btn" class="flex-1 gradient-danger text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg> Tolak </button> <button id="approve-withdrawal-btn" class="flex-1 gradient-success text-white font-bold py-3 rounded-xl hover:opacity-90 transition-all shadow-lg flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg> Setujui </button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // App State
    let currentUser = null;
    let allData = [];
    let editingUser = null;
    let deletingUser = null;
    let currentWithdrawal = null;
    let isInitialized = false;
    let isVpnDetected = false;
    
    let currentQuestion = null;
    let currentOptions = [];
    let correctAnswer = null;
    let questionNumber = 1;
    let timerInterval = null;
    let startTime = null;
    let hasAnswered = false;
    let canClaimReward = false;
    
    // VPN Detection Function
    async function detectVPN() {
      try {
        // Check using multiple VPN detection APIs
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        // Check if using VPN, proxy, or datacenter
        if (data.asn && (
          data.asn.toLowerCase().includes('vpn') ||
          data.asn.toLowerCase().includes('proxy') ||
          data.asn.toLowerCase().includes('datacenter') ||
          data.asn.toLowerCase().includes('hosting')
        )) {
          return true;
        }
        
        // Additional check using org field
        if (data.org && (
          data.org.toLowerCase().includes('vpn') ||
          data.org.toLowerCase().includes('proxy') ||
          data.org.toLowerCase().includes('datacenter') ||
          data.org.toLowerCase().includes('hosting')
        )) {
          return true;
        }
        
        // Fallback check using IPHub API (free tier)
        try {
          const ipHubResponse = await fetch(`https://v2.api.iphub.info/ip/${data.ip}`);
          const ipHubData = await ipHubResponse.json();
          
          // block = 1 means VPN/Proxy detected
          if (ipHubData.block === 1) {
            return true;
          }
        } catch (e) {
          // If IPHub fails, continue with other checks
        }
        
        return false;
      } catch (error) {
        console.error('VPN detection error:', error);
        // If detection fails, allow login (fail-safe approach)
        return false;
      }
    }
    
    // Default Config
    const defaultConfig = {
      app_title: 'Game Kecerdasan Berhitung',
      welcome_text: 'Selamat datang di game kecerdasan!',
      admin_username: 'admin'
    };
    
    // Data Handler
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        
        // IMPORTANT: Data di Canva Sheet disimpan secara permanen
        // Perubahan code tidak akan menghapus data yang sudah ada
        // Data hanya berubah melalui user action (create, update, delete)
        
        // Restore session on first data load
        if (!isInitialized) {
          isInitialized = true;
          restoreSession();
        }
        
        // Update current user data if logged in
        if (currentUser) {
          const updatedUser = allData.find(d => d.__backendId === currentUser.__backendId);
          if (updatedUser) {
            currentUser = updatedUser;
            updateUserPoints();
          }
        }
        
        // Update admin panel if visible
        if (!document.getElementById('admin-screen').classList.contains('hidden')) {
          renderAdminPanel();
        }
        
        // Update withdrawal list if on points screen
        if (!document.getElementById('points-screen').classList.contains('hidden')) {
          renderWithdrawalList();
        }
      }
    };
    
    // Element SDK Handler
    const elementHandler = {
      defaultConfig,
      onConfigChange: async (config) => {
        const title = config.app_title || defaultConfig.app_title;
        const subtitle = config.welcome_text || defaultConfig.welcome_text;
        
        const mainTitle = document.getElementById('main-title');
        const mainSubtitle = document.getElementById('main-subtitle');
        
        if (mainTitle) mainTitle.textContent = title;
        if (mainSubtitle) mainSubtitle.textContent = subtitle;
      },
      mapToCapabilities: (config) => ({
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      }),
      mapToEditPanelValues: (config) => new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['welcome_text', config.welcome_text || defaultConfig.welcome_text],
        ['admin_username', config.admin_username || defaultConfig.admin_username]
      ])
    };
    
    // Initialize SDKs
    async function initApp() {
      if (window.elementSdk) {
        window.elementSdk.init(elementHandler);
      }
      
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to init data SDK');
        }
      }
      
      setupEventListeners();
      generateQuestion();
    }
    
    function setupEventListeners() {
      // Toggle forms
      document.getElementById('show-register').addEventListener('click', () => {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('register-form').classList.remove('hidden');
      });
      
      document.getElementById('show-login').addEventListener('click', () => {
        document.getElementById('register-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
      });
      
      // Login form
      document.getElementById('login-form-element').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        const errorEl = document.getElementById('login-error');
        const loginBtn = document.getElementById('login-btn');
        
        if (!username || !password) {
          errorEl.textContent = 'Mohon isi semua field';
          errorEl.classList.remove('hidden');
          return;
        }
        
        // Show loading state
        loginBtn.disabled = true;
        loginBtn.textContent = 'Memeriksa koneksi...';
        
        // Detect VPN
        const vpnDetected = await detectVPN();
        
        if (vpnDetected) {
          errorEl.innerHTML = 'üö´ VPN terdeteksi! Matikan VPN Anda untuk melanjutkan.<br><span class="text-xs">Aplikasi ini tidak mengizinkan penggunaan VPN demi keamanan.</span>';
          errorEl.classList.remove('hidden');
          loginBtn.disabled = false;
          loginBtn.textContent = 'Masuk Sekarang ‚Üí';
          return;
        }
        
        const users = allData.filter(d => d.type === 'user');
        const user = users.find(u => u.username === username && u.password === password);
        
        if (!user) {
          errorEl.textContent = 'Username atau password salah';
          errorEl.classList.remove('hidden');
          loginBtn.disabled = false;
          loginBtn.textContent = 'Masuk Sekarang ‚Üí';
          return;
        }
        
        if (user.is_blocked === true) {
          errorEl.textContent = 'Akun Anda telah diblokir. Hubungi admin.';
          errorEl.classList.remove('hidden');
          loginBtn.disabled = false;
          loginBtn.textContent = 'Masuk Sekarang ‚Üí';
          return;
        }
        
        currentUser = user;
        errorEl.classList.add('hidden');
        loginBtn.disabled = false;
        loginBtn.textContent = 'Masuk Sekarang ‚Üí';
        loginSuccess();
      });
      
      // Register form
      document.getElementById('register-form-element').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('register-username').value.trim();
        const password = document.getElementById('register-password').value;
        const confirm = document.getElementById('register-confirm').value;
        const errorEl = document.getElementById('register-error');
        const registerBtn = document.getElementById('register-btn');
        
        if (!username || !password || !confirm) {
          errorEl.textContent = 'Mohon isi semua field';
          errorEl.classList.remove('hidden');
          return;
        }
        
        if (password !== confirm) {
          errorEl.textContent = 'Password tidak cocok';
          errorEl.classList.remove('hidden');
          return;
        }
        
        if (password.length < 4) {
          errorEl.textContent = 'Password minimal 4 karakter';
          errorEl.classList.remove('hidden');
          return;
        }
        
        // Show loading state
        registerBtn.disabled = true;
        registerBtn.textContent = 'Memeriksa koneksi...';
        
        // Detect VPN
        const vpnDetected = await detectVPN();
        
        if (vpnDetected) {
          errorEl.innerHTML = 'üö´ VPN terdeteksi! Matikan VPN Anda untuk melanjutkan.<br><span class="text-xs">Aplikasi ini tidak mengizinkan penggunaan VPN demi keamanan.</span>';
          errorEl.classList.remove('hidden');
          registerBtn.disabled = false;
          registerBtn.textContent = 'Daftar Sekarang ‚Üí';
          return;
        }
        
        const users = allData.filter(d => d.type === 'user');
        if (users.find(u => u.username === username)) {
          errorEl.textContent = 'Username sudah digunakan';
          errorEl.classList.remove('hidden');
          registerBtn.disabled = false;
          registerBtn.textContent = 'Daftar Sekarang ‚Üí';
          return;
        }
        
        if (allData.length >= 999) {
          errorEl.textContent = 'Batas data tercapai';
          errorEl.classList.remove('hidden');
          registerBtn.disabled = false;
          registerBtn.textContent = 'Daftar Sekarang ‚Üí';
          return;
        }
        
        const newUser = {
          type: 'user',
          username,
          password,
          points: 0,
          is_blocked: false,
          created_at: new Date().toISOString()
        };
        
        if (window.dataSdk) {
          const result = await window.dataSdk.create(newUser);
          if (!result.isOk) {
            errorEl.textContent = 'Gagal mendaftar';
            errorEl.classList.remove('hidden');
            registerBtn.disabled = false;
            registerBtn.textContent = 'Daftar Sekarang ‚Üí';
            return;
          }
        }
        
        showToast('Pendaftaran berhasil! Silakan login.');
        document.getElementById('register-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
        document.getElementById('register-username').value = '';
        document.getElementById('register-password').value = '';
        document.getElementById('register-confirm').value = '';
        errorEl.classList.add('hidden');
        registerBtn.disabled = false;
        registerBtn.textContent = 'Daftar Sekarang ‚Üí';
      });
      
      // Logout buttons
      document.getElementById('logout-btn')?.addEventListener('click', logout);
      document.getElementById('points-logout-btn')?.addEventListener('click', logout);
      document.getElementById('admin-logout-btn')?.addEventListener('click', logout);
      document.getElementById('maintenance-logout-btn')?.addEventListener('click', logout);
      
      // Reward points button
      document.getElementById('save-reward-points-btn')?.addEventListener('click', saveRewardPoints);
      
      // Maintenance mode buttons
      document.getElementById('activate-maintenance-btn')?.addEventListener('click', activateMaintenanceMode);
      document.getElementById('deactivate-maintenance-btn')?.addEventListener('click', deactivateMaintenanceMode);
      
      // Edit user modal
      document.getElementById('close-edit-modal').addEventListener('click', closeEditModal);
      document.getElementById('cancel-edit-btn').addEventListener('click', closeEditModal);
      document.getElementById('save-edit-btn').addEventListener('click', saveUserEdit);
      
      // Delete user modal
      document.getElementById('cancel-delete-btn').addEventListener('click', closeDeleteModal);
      document.getElementById('confirm-delete-btn').addEventListener('click', confirmDeleteUser);
      
      // Withdrawal modal
      document.getElementById('withdraw-btn').addEventListener('click', openWithdrawalModal);
      document.getElementById('close-withdrawal-modal').addEventListener('click', closeWithdrawalModal);
      document.getElementById('cancel-withdrawal-btn').addEventListener('click', closeWithdrawalModal);
      document.getElementById('withdrawal-form').addEventListener('submit', submitWithdrawal);
      
      // Withdrawal detail modal
      document.getElementById('close-withdrawal-detail-modal').addEventListener('click', closeWithdrawalDetailModal);
      document.getElementById('approve-withdrawal-btn').addEventListener('click', approveWithdrawal);
      document.getElementById('reject-withdrawal-btn').addEventListener('click', rejectWithdrawal);
      
      // Quiz buttons
      document.getElementById('next-btn').addEventListener('click', nextQuestion);
      document.getElementById('reward-btn').addEventListener('click', claimReward);
      
      // Navigation
      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', () => {
          const page = btn.dataset.page;
          if (page === 'admin' && currentUser.username !== (window.elementSdk?.config?.admin_username || defaultConfig.admin_username)) {
            return;
          }
          navigateToPage(page);
        });
      });
    }
    
    function loginSuccess() {
      document.getElementById('user-greeting').textContent = `Halo, ${currentUser.username}!`;
      document.getElementById('points-user-greeting').textContent = `Halo, ${currentUser.username}!`;
      document.getElementById('admin-user-greeting').textContent = `Halo, ${currentUser.username}!`;
      
      // Save session to localStorage
      try {
        localStorage.setItem('gameKecerdasanSession', JSON.stringify({
          backendId: currentUser.__backendId,
          username: currentUser.username
        }));
      } catch (e) {
        console.error('Failed to save session:', e);
      }
      
      const adminUsername = window.elementSdk?.config?.admin_username || defaultConfig.admin_username;
      const isAdmin = currentUser.username === adminUsername;
      
      // Check maintenance mode
      const maintenanceSettings = allData.find(d => d.type === 'settings' && d.is_maintenance === true);
      if (maintenanceSettings && !isAdmin) {
        // Show maintenance screen for non-admin users
        document.getElementById('maintenance-message-display').textContent = maintenanceSettings.maintenance_message || 'Aplikasi sedang dalam perbaikan. Mohon tunggu beberapa saat lagi.';
        showScreen('maintenance');
        return;
      }
      
      if (isAdmin) {
        document.getElementById('admin-nav-btn').style.display = 'flex';
        document.getElementById('admin-nav-btn-2').style.display = 'flex';
      } else {
        document.getElementById('admin-nav-btn').style.display = 'none';
        document.getElementById('admin-nav-btn-2').style.display = 'none';
      }
      
      updateUserPoints();
      showScreen('dashboard');
      startTimer();
    }
    
    function restoreSession() {
      try {
        const sessionData = localStorage.getItem('gameKecerdasanSession');
        if (!sessionData) return;
        
        const session = JSON.parse(sessionData);
        const user = allData.find(d => d.__backendId === session.backendId && d.type === 'user');
        
        if (user) {
          // Check if user is blocked
          if (user.is_blocked === true) {
            localStorage.removeItem('gameKecerdasanSession');
            return;
          }
          
          currentUser = user;
          loginSuccess();
        } else {
          // Session invalid, clear it
          localStorage.removeItem('gameKecerdasanSession');
        }
      } catch (e) {
        console.error('Failed to restore session:', e);
        localStorage.removeItem('gameKecerdasanSession');
      }
    }
    
    function logout() {
      currentUser = null;
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
      stopTimer();
      
      // Clear session from localStorage
      try {
        localStorage.removeItem('gameKecerdasanSession');
      } catch (e) {
        console.error('Failed to clear session:', e);
      }
      
      showScreen('auth');
    }
    
    function updateUserPoints() {
      const points = currentUser?.points ?? 0;
      const rupiah = points * 1;
      
      document.getElementById('dashboard-points').textContent = points;
      document.getElementById('dashboard-rupiah').textContent = `Rp ${rupiah.toLocaleString('id-ID')}`;
      document.getElementById('total-points').textContent = points;
      
      // Update progress circle
      const circumference = 440;
      const progress = Math.min(points / 100, 1);
      const offset = circumference - (progress * circumference);
      document.getElementById('progress-circle').style.strokeDashoffset = offset;
    }
    
    function showScreen(screen) {
      document.getElementById('auth-screen').classList.add('hidden');
      document.getElementById('dashboard-screen').classList.add('hidden');
      document.getElementById('points-screen').classList.add('hidden');
      document.getElementById('admin-screen').classList.add('hidden');
      document.getElementById('maintenance-screen').classList.add('hidden');
      
      document.getElementById(`${screen}-screen`).classList.remove('hidden');
      
      if (screen === 'dashboard') {
        if (!timerInterval) startTimer();
      } else {
        stopTimer();
      }
      
      if (screen === 'admin') {
        renderAdminPanel();
      }
      
      if (screen === 'points') {
        renderWithdrawalList();
      }
    }
    
    // Reward Points Functions
    async function saveRewardPoints() {
      const rewardPoints = parseInt(document.getElementById('reward-points-input').value);
      
      if (!rewardPoints || rewardPoints < 1 || rewardPoints > 100) {
        showToast('Jumlah poin harus antara 1-100', 'error');
        return;
      }
      
      if (allData.length >= 999) {
        showToast('Batas data tercapai', 'error');
        return;
      }
      
      // Check if settings already exist
      const existingSettings = allData.find(d => d.type === 'settings');
      
      if (window.dataSdk) {
        if (existingSettings) {
          // Update existing settings
          const result = await window.dataSdk.update({
            ...existingSettings,
            reward_points: rewardPoints
          });
          
          if (result.isOk) {
            showToast(`Poin reward berhasil diubah menjadi ${rewardPoints} poin!`);
            updateRewardPointsUI(rewardPoints);
          } else {
            showToast('Gagal mengubah poin reward', 'error');
          }
        } else {
          // Create new settings
          const result = await window.dataSdk.create({
            type: 'settings',
            is_maintenance: false,
            maintenance_message: 'Aplikasi sedang dalam perbaikan. Mohon tunggu beberapa saat lagi.',
            reward_points: rewardPoints
          });
          
          if (result.isOk) {
            showToast(`Poin reward berhasil diatur menjadi ${rewardPoints} poin!`);
            updateRewardPointsUI(rewardPoints);
          } else {
            showToast('Gagal mengatur poin reward', 'error');
          }
        }
      }
    }
    
    function updateRewardPointsUI(points) {
      const currentRewardBadge = document.getElementById('current-reward-points');
      const rewardBtnText = document.getElementById('reward-btn-text');
      const resultSubtext = document.getElementById('result-subtext');
      
      if (currentRewardBadge) {
        currentRewardBadge.textContent = `${points} Poin`;
      }
      
      if (rewardBtnText) {
        rewardBtnText.textContent = `Tonton Iklan untuk +${points} Poin`;
      }
      
      // Update result subtext if it's showing the reward message
      if (resultSubtext && resultSubtext.textContent.includes('Tonton iklan')) {
        resultSubtext.textContent = `Tonton iklan untuk mendapat ${points} poin bonus!`;
      }
    }
    
    // Maintenance Mode Functions
    async function activateMaintenanceMode() {
      const message = document.getElementById('maintenance-message-input').value.trim();
      
      if (!message) {
        showToast('Harap isi pesan perbaikan', 'error');
        return;
      }
      
      if (allData.length >= 999) {
        showToast('Batas data tercapai', 'error');
        return;
      }
      
      // Check if settings already exist
      const existingSettings = allData.find(d => d.type === 'settings');
      
      if (window.dataSdk) {
        if (existingSettings) {
          // Update existing settings
          const result = await window.dataSdk.update({
            ...existingSettings,
            is_maintenance: true,
            maintenance_message: message
          });
          
          if (result.isOk) {
            showToast('Mode perbaikan berhasil diaktifkan!');
            updateMaintenanceUI(true);
          } else {
            showToast('Gagal mengaktifkan mode perbaikan', 'error');
          }
        } else {
          // Create new settings
          const result = await window.dataSdk.create({
            type: 'settings',
            is_maintenance: true,
            maintenance_message: message
          });
          
          if (result.isOk) {
            showToast('Mode perbaikan berhasil diaktifkan!');
            updateMaintenanceUI(true);
          } else {
            showToast('Gagal mengaktifkan mode perbaikan', 'error');
          }
        }
      }
    }
    
    async function deactivateMaintenanceMode() {
      const existingSettings = allData.find(d => d.type === 'settings');
      
      if (!existingSettings) return;
      
      if (window.dataSdk) {
        const result = await window.dataSdk.update({
          ...existingSettings,
          is_maintenance: false
        });
        
        if (result.isOk) {
          showToast('Mode perbaikan berhasil dinonaktifkan!');
          updateMaintenanceUI(false);
        } else {
          showToast('Gagal menonaktifkan mode perbaikan', 'error');
        }
      }
    }
    
    function updateMaintenanceUI(isActive) {
      const statusBadge = document.getElementById('maintenance-status-badge');
      const activateBtn = document.getElementById('activate-maintenance-btn');
      const deactivateBtn = document.getElementById('deactivate-maintenance-btn');
      
      if (isActive) {
        statusBadge.textContent = 'Aktif';
        statusBadge.className = 'px-3 py-1 rounded-lg bg-red-500 text-white text-xs font-bold';
        activateBtn.style.display = 'none';
        deactivateBtn.style.display = 'flex';
      } else {
        statusBadge.textContent = 'Nonaktif';
        statusBadge.className = 'px-3 py-1 rounded-lg bg-green-500 text-white text-xs font-bold';
        activateBtn.style.display = 'flex';
        deactivateBtn.style.display = 'none';
      }
    }
    
    function navigateToPage(page) {
      if (page === 'quiz') {
        showScreen('dashboard');
      } else {
        showScreen(page);
      }
      
      document.querySelectorAll('.nav-item').forEach(btn => {
        if (btn.dataset.page === page) {
          btn.classList.add('active');
          btn.classList.remove('text-gray-500');
        } else {
          btn.classList.remove('active');
          btn.classList.add('text-gray-500');
        }
      });
    }
    
    // Quiz Functions
    function generateQuestion() {
      const operation = '+';
      
      let num1, num2;
      
      // Generate numbers from 1-100
      num1 = Math.floor(Math.random() * 100) + 1;
      num2 = Math.floor(Math.random() * 100) + 1;
      correctAnswer = num1 + num2;
      
      currentQuestion = `${num1} ${operation} ${num2} = ?`;
      
      // Generate options
      currentOptions = [correctAnswer];
      while (currentOptions.length < 4) {
        const offset = Math.floor(Math.random() * 20) - 10;
        const option = correctAnswer + offset;
        if (option > 0 && !currentOptions.includes(option)) {
          currentOptions.push(option);
        }
      }
      
      // Shuffle options
      currentOptions.sort(() => Math.random() - 0.5);
      
      renderQuestion();
      hasAnswered = false;
      canClaimReward = false;
    }
    
    function renderQuestion() {
      document.getElementById('quiz-question').textContent = currentQuestion;
      document.getElementById('question-number').textContent = questionNumber;
      
      // Update reward button text based on settings
      const rewardSettings = allData.find(d => d.type === 'settings');
      const rewardPoints = rewardSettings?.reward_points || 5;
      document.getElementById('reward-btn-text').textContent = `Klaim +${rewardPoints} Poin Bonus`;
      
      const optionsContainer = document.getElementById('answer-options');
      optionsContainer.innerHTML = '';
      
      currentOptions.forEach(option => {
        const button = document.createElement('button');
        button.className = 'answer-btn bg-white hover:bg-purple-50 border-3 border-purple-200 text-gray-800 font-bold py-6 rounded-2xl text-2xl transition-all shadow-md hover:shadow-lg hover:border-purple-400';
        button.textContent = option;
        button.addEventListener('click', () => checkAnswer(option, button));
        optionsContainer.appendChild(button);
      });
      
      document.getElementById('result-feedback').classList.add('hidden');
      document.getElementById('reward-section').classList.add('hidden');
      document.getElementById('next-btn').classList.add('hidden');
    }
    
    async function checkAnswer(selected, button) {
      if (hasAnswered) return;
      hasAnswered = true;
      
      const isCorrect = selected === correctAnswer;
      
      // Get reward points from settings
      const rewardSettings = allData.find(d => d.type === 'settings');
      const rewardPoints = rewardSettings?.reward_points || 5;
      
      // Disable all buttons
      document.querySelectorAll('.answer-btn').forEach(btn => {
        btn.disabled = true;
        btn.classList.add('opacity-50');
      });
      
      // Show result
      const resultFeedback = document.getElementById('result-feedback');
      const resultIcon = document.getElementById('result-icon');
      const resultText = document.getElementById('result-text');
      const resultSubtext = document.getElementById('result-subtext');
      
      if (isCorrect) {
        button.classList.add('bg-green-500', 'text-white', 'border-green-500');
        resultIcon.textContent = 'üéâ';
        resultText.textContent = 'Benar!';
        resultText.className = 'text-2xl font-black mb-1 text-green-600';
        resultSubtext.textContent = `Klik tombol di bawah untuk mendapat ${rewardPoints} poin bonus!`;
        
        // Jangan tambahkan poin di sini, hanya aktifkan tombol reward
        canClaimReward = true;
        document.getElementById('reward-section').classList.remove('hidden');
        document.getElementById('reward-btn').disabled = false;
      } else {
        button.classList.add('bg-red-500', 'text-white', 'border-red-500');
        resultIcon.textContent = 'üòû';
        resultText.textContent = 'Salah!';
        resultText.className = 'text-2xl font-black mb-1 text-red-600';
        resultSubtext.textContent = `Jawaban yang benar adalah ${correctAnswer}`;
        
        canClaimReward = false;
        document.getElementById('reward-section').classList.remove('hidden');
        document.getElementById('reward-btn').disabled = true;
      }
      
      resultFeedback.classList.remove('hidden');
      document.getElementById('next-btn').classList.remove('hidden');
    }
    
    async function claimReward() {
      if (!canClaimReward) return;
      
      // Get reward points from settings
      const rewardSettings = allData.find(d => d.type === 'settings');
      const rewardPoints = rewardSettings?.reward_points || 5;
      
      const rewardBtn = document.getElementById('reward-btn');
      rewardBtn.disabled = true;
      rewardBtn.innerHTML = '<span>Menampilkan iklan...</span>';
      
      // Monetag Interstitial akan otomatis muncul karena sudah loaded di page
      // Tunggu beberapa saat untuk user melihat/menutup iklan
      setTimeout(() => {
        // Give reward after delay
        claimRewardPoints(rewardPoints, rewardBtn);
      }, 3000);
    }
    
    async function claimRewardPoints(rewardPoints, rewardBtn) {
      // Give reward to user
      if (window.dataSdk && currentUser) {
        const updatedUser = {
          ...currentUser,
          points: (currentUser.points || 0) + rewardPoints
        };
        const result = await window.dataSdk.update(updatedUser);
        
        if (result.isOk) {
          showToast(`Selamat! ${rewardPoints} poin berhasil ditambahkan üéÅ`);
          rewardBtn.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg><span>Reward Diklaim!</span>';
          canClaimReward = false;
        } else {
          showToast('Gagal mengklaim reward', 'error');
          rewardBtn.disabled = false;
          rewardBtn.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><span id="reward-btn-text">Klaim +' + rewardPoints + ' Poin Bonus</span>';
        }
      }
    }
    
    function nextQuestion() {
      questionNumber++;
      hasAnswered = false;
      canClaimReward = false;
      
      // Reset reward button
      const rewardBtn = document.getElementById('reward-btn');
      const rewardSettings = allData.find(d => d.type === 'settings');
      const rewardPoints = rewardSettings?.reward_points || 5;
      rewardBtn.disabled = true;
      rewardBtn.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <span id="reward-btn-text">Klaim +${rewardPoints} Poin Bonus</span>`;
      
      generateQuestion();
    }
    
    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const seconds = (elapsed % 60).toString().padStart(2, '0');
        document.getElementById('timer').textContent = `${minutes}:${seconds}`;
      }, 1000);
    }
    
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
    
    // Withdrawal Functions
    function openWithdrawalModal() {
      document.getElementById('withdrawal-modal').classList.remove('hidden');
      document.getElementById('withdrawal-amount').value = '';
      document.getElementById('withdrawal-phone').value = '';
      document.getElementById('withdrawal-error').classList.add('hidden');
    }
    
    function closeWithdrawalModal() {
      document.getElementById('withdrawal-modal').classList.add('hidden');
    }
    
    async function submitWithdrawal(e) {
      e.preventDefault();
      
      const amount = parseInt(document.getElementById('withdrawal-amount').value);
      const phone = document.getElementById('withdrawal-phone').value.trim();
      const errorEl = document.getElementById('withdrawal-error');
      
      if (!amount || amount <= 0) {
        errorEl.textContent = 'Jumlah poin tidak valid';
        errorEl.classList.remove('hidden');
        return;
      }
      
      if (amount < 50) {
        errorEl.textContent = 'Minimal penarikan adalah Rp 50';
        errorEl.classList.remove('hidden');
        return;
      }
      
      if (amount > currentUser.points) {
        errorEl.textContent = 'Poin tidak mencukupi';
        errorEl.classList.remove('hidden');
        return;
      }
      
      if (!phone || phone.length < 10) {
        errorEl.textContent = 'Nomor DANA tidak valid';
        errorEl.classList.remove('hidden');
        return;
      }
      
      if (allData.length >= 999) {
        errorEl.textContent = 'Batas data tercapai';
        errorEl.classList.remove('hidden');
        return;
      }
      
      // Kurangi poin user terlebih dahulu
      if (window.dataSdk) {
        const updatedUser = {
          ...currentUser,
          points: (currentUser.points || 0) - amount
        };
        
        const userResult = await window.dataSdk.update(updatedUser);
        if (!userResult.isOk) {
          errorEl.textContent = 'Gagal mengurangi poin';
          errorEl.classList.remove('hidden');
          return;
        }
        
        // Buat withdrawal request setelah poin dikurangi
        const withdrawal = {
          type: 'withdrawal',
          username: currentUser.username,
          amount,
          phone,
          status: 'pending',
          admin_note: '',
          created_at: new Date().toISOString()
        };
        
        const result = await window.dataSdk.create(withdrawal);
        if (result.isOk) {
          showToast('Permintaan penarikan berhasil! Poin telah dikurangi.');
          closeWithdrawalModal();
        } else {
          // Rollback: kembalikan poin jika gagal membuat withdrawal
          await window.dataSdk.update(currentUser);
          errorEl.textContent = 'Gagal mengajukan penarikan';
          errorEl.classList.remove('hidden');
        }
      }
    }
    
    function renderWithdrawalList() {
      const withdrawals = allData.filter(d => d.type === 'withdrawal' && d.username === currentUser.username);
      const list = document.getElementById('withdrawal-list');
      
      list.innerHTML = '';
      
      if (withdrawals.length === 0) {
        list.innerHTML = '<p class="text-center text-gray-500 py-8 bg-white rounded-2xl">Belum ada riwayat penarikan</p>';
        return;
      }
      
      withdrawals.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).forEach(wd => {
        const card = document.createElement('div');
        card.className = 'glass-effect rounded-2xl p-4 card-shadow';
        
        let statusBadge = '';
        let statusColor = '';
        
        if (wd.status === 'approved') {
          statusBadge = 'Disetujui';
          statusColor = 'bg-green-500';
        } else if (wd.status === 'rejected') {
          statusBadge = 'Ditolak';
          statusColor = 'bg-red-500';
        } else {
          statusBadge = 'Pending';
          statusColor = 'bg-yellow-500';
        }
        
        const adminNoteHtml = wd.admin_note ? `
          <div class="mt-3 bg-blue-50 border-2 border-blue-200 rounded-xl p-3">
            <p class="text-xs font-bold text-blue-700 mb-1 flex items-center gap-1">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              Catatan Admin:
            </p>
            <p class="text-sm text-blue-900">${wd.admin_note}</p>
          </div>
        ` : '';
        
        card.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <span class="px-3 py-1 rounded-full ${statusColor} text-white text-xs font-bold">${statusBadge}</span>
            <span class="text-xs text-gray-500">${new Date(wd.created_at).toLocaleString('id-ID')}</span>
          </div>
          <div class="flex items-center justify-between mb-3">
            <div>
              <p class="text-sm text-gray-600">Jumlah Penarikan</p>
              <p class="text-2xl font-black text-purple-600">${wd.amount} poin</p>
              <p class="text-sm text-green-600 font-bold">‚âà Rp ${(wd.amount * 1).toLocaleString('id-ID')}</p>
            </div>
            <div class="text-right">
              <p class="text-xs text-gray-500">Nomor DANA</p>
              <p class="text-sm font-bold text-gray-800">${wd.phone}</p>
            </div>
          </div>
          ${adminNoteHtml}
          <button onclick="deleteUserWithdrawal('${wd.__backendId}')" class="w-full mt-3 bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-xl transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            Hapus Riwayat
          </button>
        `;
        
        list.appendChild(card);
      });
    }
    
    // Admin Panel Functions
    function renderAdminPanel() {
      const users = allData.filter(d => d.type === 'user');
      const withdrawals = allData.filter(d => d.type === 'withdrawal');
      
      const totalPoints = users.reduce((sum, u) => sum + (u.points || 0), 0);
      document.getElementById('stat-users').textContent = users.length;
      document.getElementById('stat-points').textContent = totalPoints;
      document.getElementById('stat-withdrawals').textContent = withdrawals.length;
      
      // Update reward points UI
      const rewardSettings = allData.find(d => d.type === 'settings');
      const rewardPoints = rewardSettings?.reward_points || 5;
      document.getElementById('reward-points-input').value = rewardPoints;
      updateRewardPointsUI(rewardPoints);
      
      // Update maintenance mode UI
      if (rewardSettings) {
        updateMaintenanceUI(rewardSettings.is_maintenance === true);
        document.getElementById('maintenance-message-input').value = rewardSettings.maintenance_message || 'Aplikasi sedang dalam perbaikan. Mohon tunggu beberapa saat lagi.';
      } else {
        updateMaintenanceUI(false);
      }
      
      // Render user list
      const userList = document.getElementById('admin-user-list');
      userList.innerHTML = '';
      
      if (users.length === 0) {
        userList.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada user terdaftar</p>';
      } else {
        users.forEach(user => {
          const userCard = document.createElement('div');
          userCard.className = 'bg-white border-2 border-gray-200 rounded-xl p-4 flex items-center justify-between hover:border-purple-300 transition-all';
          
          const blockedBadge = user.is_blocked ? 
            '<span class="inline-flex items-center px-2 py-1 rounded-lg bg-red-500 text-white text-xs font-bold ml-2">DIBLOKIR</span>' : '';
          
          userCard.innerHTML = `
            <div class="flex items-center gap-3 flex-1">
              <div class="w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center text-white font-bold text-sm">
                ${user.username.charAt(0).toUpperCase()}
              </div>
              <div>
                <p class="font-bold text-gray-800 flex items-center">
                  ${user.username}
                  ${blockedBadge}
                </p>
                <p class="text-sm text-gray-600">${user.points || 0} poin</p>
              </div>
            </div>
            <div class="flex gap-2">
              <button onclick="openEditUserModal('${user.__backendId}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-bold transition-all">
                Edit
              </button>
              <button onclick="openDeleteUserModal('${user.__backendId}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-bold transition-all">
                Hapus
              </button>
            </div>
          `;
          
          userList.appendChild(userCard);
        });
      }
      
      // Render withdrawal list
      const withdrawalList = document.getElementById('admin-withdrawal-list');
      withdrawalList.innerHTML = '';
      
      if (withdrawals.length === 0) {
        withdrawalList.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada riwayat penarikan</p>';
      } else {
        withdrawals.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).forEach(wd => {
          const wdCard = document.createElement('div');
          wdCard.className = 'bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-purple-300 transition-all cursor-pointer';
          
          let statusBadge = '';
          if (wd.status === 'approved') {
            statusBadge = '<span class="px-2 py-1 rounded-lg bg-green-500 text-white text-xs font-bold">Disetujui</span>';
          } else if (wd.status === 'rejected') {
            statusBadge = '<span class="px-2 py-1 rounded-lg bg-red-500 text-white text-xs font-bold">Ditolak</span>';
          } else {
            statusBadge = '<span class="px-2 py-1 rounded-lg bg-yellow-500 text-white text-xs font-bold">Pending</span>';
          }
          
          wdCard.innerHTML = `
            <div class="flex items-center justify-between mb-2">
              <p class="font-bold text-gray-800">${wd.username}</p>
              ${statusBadge}
            </div>
            <p class="text-sm text-gray-600 mb-1">Jumlah: <strong>${wd.amount} poin</strong> ‚Üí <strong>Rp ${(wd.amount * 1).toLocaleString('id-ID')}</strong></p>
            <p class="text-xs text-gray-500">Nomor DANA: ${wd.phone}</p>
            <p class="text-xs text-gray-500 mb-3">${new Date(wd.created_at).toLocaleString('id-ID')}</p>
            <div class="flex gap-2">
              <button onclick="event.stopPropagation(); openWithdrawalDetailModal('${wd.__backendId}')" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
                Detail
              </button>
              <button onclick="event.stopPropagation(); deleteAdminWithdrawal('${wd.__backendId}')" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
                Hapus
              </button>
            </div>
          `;
          
          withdrawalList.appendChild(wdCard);
        });
      }
    }
    
    function openEditUserModal(backendId) {
      const user = allData.find(d => d.__backendId === backendId);
      if (!user) return;
      
      editingUser = user;
      document.getElementById('edit-username').value = user.username;
      document.getElementById('edit-password').value = '';
      document.getElementById('edit-points').value = user.points || 0;
      document.getElementById('edit-blocked').checked = user.is_blocked || false;
      
      document.getElementById('edit-user-modal').classList.remove('hidden');
    }
    
    function closeEditModal() {
      editingUser = null;
      document.getElementById('edit-user-modal').classList.add('hidden');
    }
    
    async function saveUserEdit() {
      if (!editingUser) return;
      
      const newUsername = document.getElementById('edit-username').value.trim();
      const newPassword = document.getElementById('edit-password').value.trim();
      const newPoints = parseInt(document.getElementById('edit-points').value) || 0;
      const isBlocked = document.getElementById('edit-blocked').checked;
      
      // Validate username
      if (!newUsername) {
        showToast('Username tidak boleh kosong', 'error');
        return;
      }
      
      // Check for duplicate username
      if (newUsername !== editingUser.username) {
        const users = allData.filter(d => d.type === 'user');
        if (users.find(u => u.username === newUsername)) {
          showToast('Username sudah digunakan', 'error');
          return;
        }
      }
      
      // Validate password if provided
      if (newPassword && newPassword.length < 4) {
        showToast('Password minimal 4 karakter', 'error');
        return;
      }
      
      const updatedUser = {
        ...editingUser,
        username: newUsername,
        points: newPoints,
        is_blocked: isBlocked
      };
      
      // Update password only if provided
      if (newPassword) {
        updatedUser.password = newPassword;
      }
      
      if (window.dataSdk) {
        const result = await window.dataSdk.update(updatedUser);
        if (result.isOk) {
          // Update all withdrawals with the new username
          if (newUsername !== editingUser.username) {
            const userWithdrawals = allData.filter(d => d.type === 'withdrawal' && d.username === editingUser.username);
            for (const wd of userWithdrawals) {
              await window.dataSdk.update({
                ...wd,
                username: newUsername
              });
            }
          }
          
          // Update current user session if editing self
          if (currentUser && currentUser.__backendId === editingUser.__backendId) {
            currentUser = updatedUser;
            updateUserPoints();
            document.getElementById('user-greeting').textContent = `Halo, ${currentUser.username}!`;
            document.getElementById('points-user-greeting').textContent = `Halo, ${currentUser.username}!`;
            document.getElementById('admin-user-greeting').textContent = `Halo, ${currentUser.username}!`;
          }
          
          showToast('User berhasil diupdate!');
          closeEditModal();
        } else {
          showToast('Gagal mengupdate user', 'error');
        }
      }
    }
    
    function openDeleteUserModal(backendId) {
      const user = allData.find(d => d.__backendId === backendId);
      if (!user) return;
      
      deletingUser = user;
      document.getElementById('delete-username').textContent = user.username;
      document.getElementById('delete-user-modal').classList.remove('hidden');
    }
    
    function closeDeleteModal() {
      deletingUser = null;
      document.getElementById('delete-user-modal').classList.add('hidden');
    }
    
    async function confirmDeleteUser() {
      if (!deletingUser) return;
      
      if (window.dataSdk) {
        const result = await window.dataSdk.delete(deletingUser);
        if (result.isOk) {
          showToast('User berhasil dihapus!');
          closeDeleteModal();
        } else {
          showToast('Gagal menghapus user', 'error');
        }
      }
    }
    
    function openWithdrawalDetailModal(backendId) {
      const withdrawal = allData.find(d => d.__backendId === backendId);
      if (!withdrawal) return;
      
      currentWithdrawal = withdrawal;
      
      document.getElementById('detail-username').textContent = withdrawal.username;
      document.getElementById('detail-amount').textContent = `${withdrawal.amount} poin ‚Üí Rp ${(withdrawal.amount * 1).toLocaleString('id-ID')}`;
      document.getElementById('detail-phone').textContent = withdrawal.phone;
      document.getElementById('detail-date').textContent = new Date(withdrawal.created_at).toLocaleString('id-ID');
      document.getElementById('admin-note-input').value = withdrawal.admin_note || '';
      
      document.getElementById('withdrawal-detail-modal').classList.remove('hidden');
    }
    
    function closeWithdrawalDetailModal() {
      currentWithdrawal = null;
      document.getElementById('withdrawal-detail-modal').classList.add('hidden');
    }
    
    async function approveWithdrawal() {
      if (!currentWithdrawal) return;
      
      const adminNote = document.getElementById('admin-note-input').value.trim();
      
      // Update withdrawal status only (poin sudah dikurangi saat user mengajukan)
      if (window.dataSdk) {
        const updatedWithdrawal = {
          ...currentWithdrawal,
          status: 'approved',
          admin_note: adminNote
        };
        
        const result = await window.dataSdk.update(updatedWithdrawal);
        if (result.isOk) {
          showToast('Penarikan disetujui!');
          closeWithdrawalDetailModal();
        } else {
          showToast('Gagal menyetujui penarikan', 'error');
        }
      }
    }
    
    async function rejectWithdrawal() {
      if (!currentWithdrawal) return;
      
      const adminNote = document.getElementById('admin-note-input').value.trim();
      
      // Kembalikan poin ke user karena penarikan ditolak
      const user = allData.find(d => d.type === 'user' && d.username === currentWithdrawal.username);
      if (!user) {
        showToast('User tidak ditemukan', 'error');
        return;
      }
      
      if (window.dataSdk) {
        // Kembalikan poin ke user
        const updatedUser = {
          ...user,
          points: (user.points || 0) + currentWithdrawal.amount
        };
        
        const userResult = await window.dataSdk.update(updatedUser);
        if (!userResult.isOk) {
          showToast('Gagal mengembalikan poin', 'error');
          return;
        }
        
        // Update withdrawal status
        const updatedWithdrawal = {
          ...currentWithdrawal,
          status: 'rejected',
          admin_note: adminNote
        };
        
        const wdResult = await window.dataSdk.update(updatedWithdrawal);
        if (wdResult.isOk) {
          showToast('Penarikan ditolak. Poin telah dikembalikan ke user.');
          closeWithdrawalDetailModal();
        } else {
          showToast('Gagal menolak penarikan', 'error');
        }
      }
    }
    
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastDiv = toast.querySelector('div');
      
      toastMessage.textContent = message;
      
      if (type === 'success') {
        toastDiv.className = 'bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 animate-toast';
      } else {
        toastDiv.className = 'bg-red-500 text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 animate-toast';
      }
      
      toast.classList.remove('hidden');
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }
    
    // Make functions global for onclick handlers
    window.openEditUserModal = openEditUserModal;
    window.openDeleteUserModal = openDeleteUserModal;
    window.deleteUserWithdrawal = deleteUserWithdrawal;
    window.deleteAdminWithdrawal = deleteAdminWithdrawal;
    window.openWithdrawalDetailModal = openWithdrawalDetailModal;
    
    // Store original content in a Map to avoid string escaping issues
    const originalCardContents = new Map();
    
    // Delete withdrawal functions
    async function deleteUserWithdrawal(backendId) {
      const withdrawal = allData.find(d => d.__backendId === backendId);
      if (!withdrawal) return;
      
      // Create inline confirmation
      const card = event.target.closest('.glass-effect, .bg-white');
      
      // Store original content in the Map
      originalCardContents.set(backendId, card.innerHTML);
      
      card.innerHTML = `
        <div class="text-center py-4">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
          </div>
          <p class="text-lg font-bold text-gray-800 mb-2">Hapus Riwayat?</p>
          <p class="text-sm text-gray-600 mb-4">Tindakan ini tidak dapat dibatalkan</p>
          <div class="flex gap-2">
            <button onclick="cancelDeleteWithdrawal('${backendId}')" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 rounded-xl transition-all">
              Batal
            </button>
            <button onclick="confirmDeleteUserWithdrawal('${backendId}')" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-xl transition-all">
              Hapus
            </button>
          </div>
        </div>
      `;
    }
    
    async function deleteAdminWithdrawal(backendId) {
      const withdrawal = allData.find(d => d.__backendId === backendId);
      if (!withdrawal) return;
      
      // Create inline confirmation
      const card = event.target.closest('.bg-white');
      
      // Store original content in the Map
      originalCardContents.set(backendId, card.innerHTML);
      
      card.innerHTML = `
        <div class="text-center py-4">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
          </div>
          <p class="text-lg font-bold text-gray-800 mb-2">Hapus Riwayat?</p>
          <p class="text-sm text-gray-600 mb-4">Tindakan ini tidak dapat dibatalkan</p>
          <div class="flex gap-2">
            <button onclick="cancelDeleteWithdrawal('${backendId}')" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 rounded-xl transition-all">
              Batal
            </button>
            <button onclick="confirmDeleteAdminWithdrawal('${backendId}')" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-xl transition-all">
              Hapus
            </button>
          </div>
        </div>
      `;
    }
    
    window.cancelDeleteWithdrawal = function(backendId) {
      const card = event.target.closest('.glass-effect, .bg-white');
      const originalContent = originalCardContents.get(backendId);
      if (originalContent) {
        card.innerHTML = originalContent;
        originalCardContents.delete(backendId);
      }
    };
    
    window.confirmDeleteUserWithdrawal = async function(backendId) {
      const withdrawal = allData.find(d => d.__backendId === backendId);
      if (!withdrawal) return;
      
      if (window.dataSdk) {
        const result = await window.dataSdk.delete(withdrawal);
        if (result.isOk) {
          originalCardContents.delete(backendId);
          showToast('Riwayat penarikan berhasil dihapus!');
        } else {
          showToast('Gagal menghapus riwayat penarikan', 'error');
        }
      }
    };
    
    window.confirmDeleteAdminWithdrawal = async function(backendId) {
      const withdrawal = allData.find(d => d.__backendId === backendId);
      if (!withdrawal) return;
      
      if (window.dataSdk) {
        const result = await window.dataSdk.delete(withdrawal);
        if (result.isOk) {
          originalCardContents.delete(backendId);
          showToast('Riwayat penarikan berhasil dihapus!');
        } else {
          showToast('Gagal menghapus riwayat penarikan', 'error');
        }
      }
    };
    
    // Initialize
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c1bf21c10195f44',t:'MTc2OTA1MjM0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
