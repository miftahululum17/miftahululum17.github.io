<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Mini App - Quiz Ads</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script async src="https://www.profitablecreativeformat.com/9865183/invoke.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes scaleIn {
      from { 
        opacity: 0;
        transform: scale(0.9);
      }
      to { 
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes slideOutRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(100px);
      }
    }
    
    .floating-coin {
      animation: float 3s ease-in-out infinite;
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out forwards;
    }
    
    .scale-in {
      animation: scaleIn 0.4s ease-out forwards;
    }
    
    .toast-notification {
      animation: slideInRight 0.3s ease-out forwards;
    }
    
    .toast-notification.hide {
      animation: slideOutRight 0.3s ease-out forwards;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      position: relative;
      overflow: hidden;
    }
    
    .gradient-bg::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .glass-card {
      background: rgba(30, 30, 50, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    }
    
    .answer-btn.correct {
      background: linear-gradient(135deg, #10b981, #059669) !important;
      border-color: #10b981 !important;
      animation: pulse 0.5s ease-in-out;
    }
    
    .answer-btn.wrong {
      background: linear-gradient(135deg, #ef4444, #dc2626) !important;
      border-color: #ef4444 !important;
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    .nav-btn {
      color: #9ca3af;
    }
    
    .nav-btn.active {
      color: #6366f1;
    }
    
    #maintenance-toggle:checked + span {
      background-color: #10b981;
    }
    
    #maintenance-toggle:checked + span:before {
      transform: translateX(24px);
    }
    
    #maintenance-toggle + span:before {
      content: '';
      position: absolute;
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full gradient-bg overflow-hidden" style="color: #ffffff;"><!-- Login/Register Page -->
  <div id="auth-page" class="h-full w-full flex flex-col items-center justify-center p-4 sm:p-6 overflow-y-auto">
   <div class="glass-card rounded-2xl sm:rounded-3xl p-6 sm:p-8 w-full max-w-md scale-in">
    <div class="text-center mb-6 sm:mb-8 slide-up">
     <div class="text-4xl sm:text-5xl mb-3">
      üîê
     </div>
     <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-indigo-400 to-purple-500 bg-clip-text text-transparent">Selamat Datang</h1>
     <p class="text-gray-300 text-xs sm:text-sm mt-2">Silakan login atau daftar akun</p>
    </div>
    <div class="flex gap-1 sm:gap-2 mb-4 sm:mb-6 bg-black/20 p-1 rounded-lg sm:rounded-xl slide-up" style="animation-delay: 0.1s"><button id="tab-login" class="flex-1 py-2 sm:py-2.5 px-3 sm:px-4 rounded-lg text-sm sm:text-base font-semibold transition-all bg-indigo-600 text-white"> Login </button> <button id="tab-register" class="flex-1 py-2 sm:py-2.5 px-3 sm:px-4 rounded-lg text-sm sm:text-base font-semibold transition-all text-gray-400 hover:text-white"> Daftar </button>
    </div>
    <form id="login-form" class="space-y-3 sm:space-y-4 slide-up" style="animation-delay: 0.2s">
     <div><label for="login-username" class="block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2">Username</label> <input type="text" id="login-username" required style="background: rgba(20, 20, 40, 0.8); color: #ffffff; border: 1px solid rgba(255,255,255,0.25);" class="w-full rounded-lg sm:rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/50 transition-all" placeholder="Masukkan username">
     </div>
     <div><label for="login-password" class="block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2">Password</label> <input type="password" id="login-password" required style="background: rgba(20, 20, 40, 0.8); color: #ffffff; border: 1px solid rgba(255,255,255,0.25);" class="w-full rounded-lg sm:rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/50 transition-all" placeholder="Masukkan password">
     </div><button type="submit" id="login-submit-btn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold py-2.5 sm:py-3 text-sm sm:text-base rounded-lg sm:rounded-xl transition-all transform hover:scale-105 active:scale-95 disabled:opacity-50 shadow-lg"> Masuk </button>
    </form>
    <form id="register-form" class="space-y-3 sm:space-y-4 hidden slide-up" style="animation-delay: 0.2s">
     <div><label for="register-username" class="block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2">Username</label> <input type="text" id="register-username" required minlength="3" class="w-full border rounded-lg sm:rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base text-white placeholder-gray-400 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/50 transition-all" style="background: rgba(20, 20, 40, 0.8); border-color: rgba(255,255,255,0.25);" placeholder="Minimal 3 karakter">
     </div>
     <div><label for="register-password" class="block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2">Password</label> <input type="password" id="register-password" required minlength="6" class="w-full border rounded-lg sm:rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base text-white placeholder-gray-400 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/50 transition-all" style="background: rgba(20, 20, 40, 0.8); border-color: rgba(255,255,255,0.25);" placeholder="Minimal 6 karakter">
     </div>
     <div><label for="register-confirm" class="block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2">Konfirmasi Password</label> <input type="password" id="register-confirm" required minlength="6" class="w-full border rounded-lg sm:rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base text-white placeholder-gray-400 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/50 transition-all" style="background: rgba(20, 20, 40, 0.8); border-color: rgba(255,255,255,0.25);" placeholder="Ulangi password">
     </div>
     <div id="admin-badge" class="hidden bg-yellow-500/20 border border-yellow-500/50 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2.5 sm:py-3 text-center">
      <p class="text-yellow-300 text-xs sm:text-sm font-semibold">üëë Akun pertama akan menjadi Admin</p>
     </div><button type="submit" id="register-submit-btn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-2.5 sm:py-3 text-sm sm:text-base rounded-lg sm:rounded-xl transition-all transform hover:scale-105 active:scale-95 disabled:opacity-50 shadow-lg"> Daftar Akun </button>
    </form>
    <div id="auth-error" class="hidden mt-4 bg-red-500/20 border border-red-500/50 rounded-xl px-4 py-3">
     <p class="text-red-300 text-sm text-center"></p>
    </div>
   </div>
  </div><!-- Main App Page -->
  <div id="app" class="hidden h-full w-full flex flex-col">
   <div class="flex-1 w-full max-w-sm mx-auto flex flex-col" style="padding: 1rem 0.75rem 6rem 0.75rem;">
    <div class="flex flex-col items-center w-full">
     <div id="home-page" class="w-full">
      <div class="w-full flex justify-between items-center mb-3 sm:mb-4 slide-up">
       <div class="flex items-center gap-1.5 sm:gap-2"><span id="user-role-badge" class="text-xs px-2 py-0.5 sm:py-1 rounded-full bg-indigo-500/30 border border-indigo-500/50 whitespace-nowrap"> ÔøΩÔøΩÔøΩÔøΩ User </span> <span id="logged-username" class="text-xs text-gray-300 truncate max-w-[70px] sm:max-w-[120px]"></span>
       </div><button id="logout-btn" class="bg-red-500/20 hover:bg-red-500/30 border border-red-500/50 text-red-300 px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-lg text-xs font-medium transition-all active:scale-95 whitespace-nowrap"> Logout </button>
      </div>
      <div class="text-center mb-3 sm:mb-4 slide-up" style="animation-delay: 0.1s">
       <div class="floating-coin text-3xl sm:text-4xl lg:text-5xl mb-2">
        üßÆ
       </div>
       <h1 id="app-title" class="text-lg sm:text-xl lg:text-2xl font-bold bg-gradient-to-r from-yellow-400 via-orange-500 to-pink-500 bg-clip-text text-transparent px-2">Quiz Penjumlahan</h1>
       <p class="text-gray-300 mt-1 text-xs sm:text-sm">Jawab benar untuk dapat reward</p>
      </div>
      <div class="glass-card stat-card rounded-xl p-3 sm:p-4 w-full mb-3 sm:mb-4 scale-in" style="animation-delay: 0.2s">
       <div class="flex justify-between items-center mb-2"><span class="text-gray-200 text-xs sm:text-sm font-medium">Total Koin</span> <span id="coin-display" class="text-lg sm:text-xl font-bold text-yellow-400">0 ÔøΩÔøΩÔøΩÔøΩ</span>
       </div>
       <div class="pt-2 border-t border-white/20">
        <div class="flex justify-between items-center"><span class="text-gray-200 text-xs font-medium">Reward per iklan</span> <span id="reward-per-ad-display" class="text-green-400 text-xs sm:text-sm font-semibold">+10 ü™ô</span>
        </div>
       </div>
      </div>
      <div class="glass-card rounded-xl p-4 sm:p-6 w-full mb-3 sm:mb-4 scale-in" style="animation-delay: 0.2s">
       <div class="text-center mb-4">
        <p class="text-gray-300 text-sm mb-3">Soal:</p>
        <h2 id="quiz-question" class="text-3xl sm:text-4xl font-bold text-white mb-1">? + ? = ?</h2>
       </div>
       <div class="grid grid-cols-2 gap-2 sm:gap-3"><button class="answer-btn glass-card hover:bg-indigo-600/30 active:bg-indigo-700/40 text-white font-bold py-4 sm:py-5 rounded-xl transition-all transform hover:scale-105 active:scale-95 text-lg sm:text-xl" data-answer="0"> 0 </button> <button class="answer-btn glass-card hover:bg-indigo-600/30 active:bg-indigo-700/40 text-white font-bold py-4 sm:py-5 rounded-xl transition-all transform hover:scale-105 active:scale-95 text-lg sm:text-xl" data-answer="1"> 0 </button> <button class="answer-btn glass-card hover:bg-indigo-600/30 active:bg-indigo-700/40 text-white font-bold py-4 sm:py-5 rounded-xl transition-all transform hover:scale-105 active:scale-95 text-lg sm:text-xl" data-answer="2"> 0 </button> <button class="answer-btn glass-card hover:bg-indigo-600/30 active:bg-indigo-700/40 text-white font-bold py-4 sm:py-5 rounded-xl transition-all transform hover:scale-105 active:scale-95 text-lg sm:text-xl" data-answer="3"> 0 </button>
       </div>
      </div><button id="watch-ad-btn" disabled class="w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold py-3 sm:py-3.5 px-6 rounded-xl transition-all duration-300 flex items-center justify-center gap-2 shadow-lg scale-in opacity-50 cursor-not-allowed mb-3" style="animation-delay: 0.3s">
       <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
       </svg><span id="button-label" class="text-sm sm:text-base">Lihat Iklan</span> </button>
      <div id="cooldown-container" class="hidden text-center scale-in mt-3 mb-3">
       <p class="text-gray-200 text-xs font-medium">Iklan berikutnya dalam</p>
       <p id="cooldown-timer" class="text-lg sm:text-xl font-bold text-indigo-300">00:00</p>
      </div>
      <div class="text-center text-gray-300 text-xs w-full px-2 slide-up" style="animation-delay: 0.5s">
       <p>üí° Jawab soal dengan benar untuk aktifkan tombol iklan</p>
      </div>
     </div>
     <div id="admin-page" class="hidden w-full overflow-y-auto" style="max-height: calc(100vh - 10rem);">
      <h2 class="text-2xl font-bold text-center mb-6 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">üëë Admin Panel</h2><!-- Maintenance Mode -->
      <div class="glass-card rounded-xl p-4 mb-4">
       <h3 class="font-bold text-white mb-3 flex items-center gap-2"><span>üîß</span> Mode Maintenance</h3>
       <div class="flex items-center justify-between"><span class="text-gray-300 text-sm">Aktifkan mode maintenance</span> <label class="relative inline-block w-12 h-6"> <input type="checkbox" id="maintenance-toggle" class="opacity-0 w-0 h-0"> <span class="absolute cursor-pointer top-0 left-0 right-0 bottom-0 bg-gray-600 rounded-full transition-all duration-300"></span> </label>
       </div>
       <p class="text-gray-400 text-xs mt-2">User biasa tidak dapat login saat mode maintenance aktif</p>
      </div><!-- SDK Settings -->
      <div class="glass-card rounded-xl p-4 mb-4">
       <h3 class="font-bold text-white mb-3 flex items-center gap-2"><span>üîß</span> Pengaturan SDK Monetag</h3>
       <div class="space-y-3">
        <div><label class="text-gray-300 text-sm block mb-2">Zone ID Interstitial</label>
         <div class="flex gap-2"><input type="text" id="zone-id-input" placeholder="9865183" class="flex-1 bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500"> <button id="save-zone-btn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold px-4 py-2 rounded-lg text-sm transition-all"> Simpan </button>
         </div>
         <p class="text-gray-400 text-xs mt-1">Dapatkan Zone ID dari dashboard Monetag Anda</p>
        </div>
       </div>
      </div><!-- Reward Settings -->
      <div class="glass-card rounded-xl p-4 mb-4">
       <h3 class="font-bold text-white mb-3 flex items-center gap-2"><span>üí∞</span> Pengaturan Reward</h3>
       <div class="space-y-3">
        <div><label class="text-gray-300 text-sm block mb-2">Poin per Iklan</label>
         <div class="flex gap-2"><input type="number" id="reward-input" min="1" class="flex-1 bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-yellow-500"> <button id="save-reward-btn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold px-4 py-2 rounded-lg text-sm transition-all"> Simpan </button>
         </div>
        </div>
        <div><label class="text-gray-300 text-sm block mb-2">Minimal Penarikan (koin)</label>
         <div class="flex gap-2"><input type="number" id="min-withdrawal-input" min="1" class="flex-1 bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-yellow-500"> <button id="save-min-withdrawal-btn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold px-4 py-2 rounded-lg text-sm transition-all"> Simpan </button>
         </div>
        </div>
        <div><label class="text-gray-300 text-sm block mb-2">Hitungan Mundur (detik)</label>
         <div class="flex gap-2"><input type="number" id="cooldown-input" min="1" class="flex-1 bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-yellow-500"> <button id="save-cooldown-btn" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold px-4 py-2 rounded-lg text-sm transition-all"> Simpan </button>
         </div>
        </div>
       </div>
      </div><!-- User Management -->
      <div class="glass-card rounded-xl p-4 mb-4">
       <h3 class="font-bold text-white mb-3 flex items-center gap-2"><span>üë•</span> Manajemen User</h3>
       <div id="user-management-list" class="space-y-2 max-h-96 overflow-y-auto">
       </div>
      </div><!-- Withdrawal Requests -->
      <div class="glass-card rounded-xl p-4 mb-4">
       <h3 class="font-bold text-white mb-3 flex items-center gap-2"><span>üí∏</span> Riwayat Penukaran Poin</h3>
       <div id="withdrawal-list" class="space-y-2 max-h-96 overflow-y-auto">
       </div>
       <div id="no-withdrawals" class="text-center py-8 text-gray-400 text-sm">
        Belum ada permintaan penukaran poin
       </div>
      </div>
     </div>
     <div id="withdrawal-page" class="hidden w-full overflow-y-auto" style="max-height: calc(100vh - 10rem);">
      <h2 class="text-2xl font-bold text-center mb-6 bg-gradient-to-r from-green-400 to-emerald-500 bg-clip-text text-transparent">üí∏ Penarikan Koin</h2>
      <div class="glass-card rounded-xl p-6 mb-4">
       <div class="text-center mb-4">
        <p class="text-gray-300 text-sm mb-2">Saldo Koin Anda</p>
        <p class="text-4xl font-bold text-yellow-400" id="withdrawal-coins">0 ü™ô</p>
        <p class="text-gray-400 text-xs mt-2" id="min-withdrawal-text">Minimal penarikan: 50 koin (Rp. 50)</p>
       </div><button id="open-withdrawal-form" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-3 px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95"> Tukar Koin </button>
      </div>
      <div class="glass-card rounded-xl p-4">
       <h3 class="font-bold text-white mb-3 flex items-center gap-2"><span>üìú</span> Riwayat Penarikan</h3>
       <div id="user-withdrawal-list" class="space-y-2 max-h-96 overflow-y-auto">
       </div>
       <div id="no-user-withdrawals" class="text-center py-8 text-gray-400 text-sm">
        Belum ada riwayat penarikan
       </div>
      </div>
     </div>
     <div id="profile-page" class="hidden w-full">
      <h2 class="text-2xl font-bold text-center mb-6 bg-gradient-to-r from-green-400 to-emerald-500 bg-clip-text text-transparent">üë§ Profil Saya</h2>
      <div class="glass-card rounded-xl p-6 mb-4">
       <div class="flex flex-col items-center mb-6">
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-3xl font-bold mb-3"><span id="profile-avatar">?</span>
        </div>
        <h3 class="text-xl font-bold text-white" id="profile-username">Username</h3><span class="text-xs px-3 py-1 rounded-full bg-indigo-500/30 border border-indigo-500/50 mt-2" id="profile-role">User</span>
       </div>
       <div class="space-y-3">
        <div class="flex justify-between items-center py-2 border-b border-white/10"><span class="text-gray-200 text-sm">Device ID</span> <span class="text-gray-400 text-xs font-mono" id="profile-device">-</span>
        </div>
        <div class="flex justify-between items-center py-2"><span class="text-gray-200 text-sm">Member Since</span> <span class="text-gray-400 text-sm" id="profile-since">-</span>
        </div>
       </div>
      </div><button id="profile-logout" class="w-full bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-500 hover:to-pink-500 text-white font-bold py-3 px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95"> Logout </button>
     </div>
    </div>
   </div>
   <div class="fixed bottom-0 left-0 right-0 glass-card border-t border-white/20 z-40">
    <div class="max-w-sm mx-auto flex justify-around items-center py-2"><button class="nav-btn active flex flex-col items-center gap-1 px-3 py-2 transition-all" data-page="home">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
      </svg><span class="text-xs">Beranda</span> </button> <button class="nav-btn flex flex-col items-center gap-1 px-3 py-2 transition-all" data-page="withdrawal">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
      </svg><span class="text-xs">Penarikan</span> </button> <button class="nav-btn flex flex-col items-center gap-1 px-3 py-2 transition-all" data-page="profile">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg><span class="text-xs">Profil</span> </button> <button id="admin-nav-btn" class="nav-btn hidden flex-col items-center gap-1 px-3 py-2 transition-all" data-page="admin">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
      </svg><span class="text-xs">Admin</span> </button>
    </div>
   </div>
   <div id="reward-popup" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="glass-card rounded-2xl sm:rounded-3xl p-6 sm:p-8 text-center max-w-xs w-full scale-in">
     <div class="text-5xl sm:text-6xl mb-3 sm:mb-4">
      ÔøΩÔøΩÔøΩ
     </div>
     <h2 id="reward-title" class="text-xl sm:text-2xl font-bold text-yellow-400 mb-2">Selamat!</h2>
     <p id="reward-message" class="text-gray-300 text-sm sm:text-base mb-4 sm:mb-6">Kamu mendapatkan +10 koin!</p><button id="close-popup" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white font-bold py-2.5 sm:py-3 px-6 sm:px-8 rounded-lg sm:rounded-xl transition-all duration-300 transform hover:scale-105 active:scale-95 text-sm sm:text-base shadow-lg"> Klaim Reward </button>
    </div>
   </div>
   <div id="loading-overlay" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center z-50">
    <div class="w-12 h-12 sm:w-16 sm:h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-3 sm:mb-4"></div>
    <p class="text-gray-300 text-sm sm:text-base">Memuat iklan...</p>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: 'Quiz Penjumlahan',
      reward_text: 'Kamu mendapatkan +10 koin!',
      button_text: 'Lihat Iklan',
      font_family: 'Poppins',
      font_size: 16
    };

    let coins = 0;
    let adsWatched = 0;
    let cooldownActive = false;
    let cooldownTime = 0;
    let currentUser = null;
    let allUsers = [];
    let currentQuestion = {};
    let correctAnswer = 0;
    let canWatchAd = false;
    let maintenanceMode = false;
    let rewardPerAd = 10;
    let minWithdrawal = 50;
    let cooldownDuration = 15;
    let withdrawalRequests = [];
    let monetagZoneId = '9865183';

    const authPage = document.getElementById('auth-page');
    const appPage = document.getElementById('app');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const tabLogin = document.getElementById('tab-login');
    const tabRegister = document.getElementById('tab-register');
    const authError = document.getElementById('auth-error');
    const adminBadge = document.getElementById('admin-badge');
    const logoutBtn = document.getElementById('logout-btn');
    const userRoleBadge = document.getElementById('user-role-badge');
    const loggedUsername = document.getElementById('logged-username');
    const watchAdBtn = document.getElementById('watch-ad-btn');
    const buttonLabel = document.getElementById('button-label');
    const coinDisplay = document.getElementById('coin-display');
    const rewardPopup = document.getElementById('reward-popup');
    const closePopupBtn = document.getElementById('close-popup');
    const loadingOverlay = document.getElementById('loading-overlay');
    const cooldownContainer = document.getElementById('cooldown-container');
    const cooldownTimer = document.getElementById('cooldown-timer');
    const appTitle = document.getElementById('app-title');
    const rewardMessage = document.getElementById('reward-message');
    const quizQuestion = document.getElementById('quiz-question');
    const answerBtns = document.querySelectorAll('.answer-btn');

    let currentDeviceId = null;
    
    function generateDeviceId() {
      let deviceId = localStorage.getItem('device_id');
      if (!deviceId) {
        deviceId = 'dev_' + Date.now() + '_' + Math.random().toString(36).substring(2, 15);
        localStorage.setItem('device_id', deviceId);
      }
      return deviceId;
    }
    
    currentDeviceId = generateDeviceId();

    function loadFromLocalStorage() {
      try {
        const storedUsers = localStorage.getItem('app_users');
        const storedWithdrawals = localStorage.getItem('app_withdrawals');
        const storedSettings = localStorage.getItem('app_settings');
        const storedCurrentUser = localStorage.getItem('current_user');
        
        if (storedUsers) allUsers = JSON.parse(storedUsers);
        if (storedWithdrawals) withdrawalRequests = JSON.parse(storedWithdrawals);
        
        if (storedSettings) {
          const settings = JSON.parse(storedSettings);
          maintenanceMode = settings.maintenanceMode || false;
          rewardPerAd = settings.rewardPerAd || 10;
          minWithdrawal = settings.minWithdrawal || 50;
          cooldownDuration = settings.cooldownDuration || 15;
          monetagZoneId = settings.monetagZoneId || '9865183';
        }
        
        if (storedCurrentUser) {
          const userId = storedCurrentUser;
          currentUser = allUsers.find(u => u.id === userId);
          if (currentUser) {
            coins = currentUser.coins || 0;
            adsWatched = currentUser.adsWatched || 0;
          }
        }
        
        console.log('‚úÖ Loaded from LocalStorage:', {
          users: allUsers.length,
          withdrawals: withdrawalRequests.length,
          currentUser: currentUser?.username
        });
      } catch (error) {
        console.error('‚ùå Error loading from LocalStorage:', error);
      }
    }

    function saveToLocalStorage() {
      try {
        localStorage.setItem('app_users', JSON.stringify(allUsers));
        localStorage.setItem('app_withdrawals', JSON.stringify(withdrawalRequests));
        localStorage.setItem('app_settings', JSON.stringify({
          maintenanceMode,
          rewardPerAd,
          minWithdrawal,
          cooldownDuration,
          monetagZoneId
        }));
        
        if (currentUser) {
          localStorage.setItem('current_user', currentUser.id);
        } else {
          localStorage.removeItem('current_user');
        }
        
        console.log('üíæ Saved to LocalStorage');
      } catch (error) {
        console.error('‚ùå Error saving to LocalStorage:', error);
      }
    }

    function showAuthError(message) {
      const errorText = authError.querySelector('p');
      errorText.textContent = message;
      authError.classList.remove('hidden');
      
      setTimeout(() => {
        authError.classList.add('hidden');
      }, 5000);
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? 'from-green-500 to-emerald-600' : 'from-red-500 to-rose-600';
      const icon = type === 'success' ? 'ÔøΩÔøΩÔøΩ' : '‚ùå';
      toast.className = `toast-notification fixed top-4 right-4 bg-gradient-to-r ${bgColor} text-white px-6 py-4 rounded-xl shadow-2xl z-50 flex items-center gap-3 max-w-xs`;
      toast.innerHTML = `<span class="text-2xl">${icon}</span><span class="font-semibold">${message}</span>`;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('hide');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 2500);
    }

    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    tabLogin.addEventListener('click', () => {
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
      tabLogin.classList.add('bg-indigo-600', 'text-white');
      tabLogin.classList.remove('text-gray-400');
      tabRegister.classList.remove('bg-indigo-600', 'text-white');
      tabRegister.classList.add('text-gray-400');
      authError.classList.add('hidden');
    });

    tabRegister.addEventListener('click', () => {
      registerForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
      tabRegister.classList.add('bg-indigo-600', 'text-white');
      tabRegister.classList.remove('text-gray-400');
      tabLogin.classList.remove('bg-indigo-600', 'text-white');
      tabLogin.classList.add('text-gray-400');
      authError.classList.add('hidden');
      
      if (allUsers.length === 0) {
        adminBadge.classList.remove('hidden');
      } else {
        adminBadge.classList.add('hidden');
      }
    });

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value;
      const confirm = document.getElementById('register-confirm').value;
      const submitBtn = document.getElementById('register-submit-btn');
      
      console.log('üìù Register attempt:', { username, usersCount: allUsers.length });
      
      if (password !== confirm) {
        showAuthError('Password tidak cocok!');
        return;
      }
      
      const userExists = allUsers.find(u => u.username === username);
      if (userExists) {
        showAuthError('Username sudah digunakan!');
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Mendaftar...';
      
      try {
        const hashedPassword = await hashPassword(password);
        const isFirstUser = allUsers.length === 0;
        
        console.log('‚úÖ Creating user:', { username, isAdmin: isFirstUser });
        
        const newUser = {
          id: 'user_' + Date.now() + '_' + Math.random().toString(36).substring(2, 15),
          username: username,
          password: hashedPassword,
          isAdmin: isFirstUser,
          coins: 0,
          adsWatched: 0,
          isBlocked: false,
          createdAt: new Date().toISOString(),
          activeDeviceId: null,
          lastLoginAt: null
        };
        
        allUsers.push(newUser);
        saveToLocalStorage();
        
        console.log('‚úÖ User created successfully');
        showToast(isFirstUser ? 'üéâ Akun admin berhasil dibuat!' : 'Akun berhasil dibuat!');
        registerForm.reset();
        
        setTimeout(() => {
          tabLogin.click();
        }, 1000);
      } catch (error) {
        console.error('‚ùå Registration error:', error);
        showAuthError('Terjadi kesalahan: ' + error.message);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Daftar Akun';
    });

    async function checkVPNorDNS() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        if (data.threat) {
          return data.threat.is_proxy || data.threat.is_vpn || data.threat.is_tor || data.threat.is_relay;
        }
        
        return false;
      } catch (error) {
        console.error('VPN check error:', error);
        return false;
      }
    }

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      const submitBtn = document.getElementById('login-submit-btn');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Memeriksa...';
      
      const isUsingVPN = await checkVPNorDNS();
      
      if (isUsingVPN) {
        showAuthError('‚ùå VPN/DNS terdeteksi! Matikan VPN untuk login.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Masuk';
        return;
      }
      
      submitBtn.textContent = 'Masuk...';
      
      const hashedPassword = await hashPassword(password);
      const user = allUsers.find(u => u.username === username && u.password === hashedPassword);
      
      if (user) {
        if (user.isBlocked) {
          showAuthError('Akun Anda telah diblokir!');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Masuk';
          return;
        }
        
        if (user.activeDeviceId && user.activeDeviceId !== currentDeviceId) {
          showAuthError('‚ùå Akun sudah aktif di perangkat lain!');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Masuk';
          return;
        }
        
        user.activeDeviceId = currentDeviceId;
        user.lastLoginAt = new Date().toISOString();
        saveToLocalStorage();
        
        currentUser = user;
        coins = user.coins || 0;
        adsWatched = user.adsWatched || 0;
        showToast('Login berhasil! üéâ');
        
        setTimeout(() => {
          if (maintenanceMode && !user.isAdmin) {
            showMaintenancePage();
          } else {
            showMainApp();
          }
        }, 500);
      } else {
        showAuthError('Username atau password salah!');
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Masuk';
    });

    logoutBtn.addEventListener('click', async () => {
      if (currentUser) {
        currentUser.activeDeviceId = null;
        saveToLocalStorage();
      }
      
      currentUser = null;
      coins = 0;
      adsWatched = 0;
      localStorage.removeItem('current_user');
      updateStats();
      
      authPage.classList.remove('hidden');
      appPage.classList.add('hidden');
      document.getElementById('maintenance-page')?.classList.add('hidden');
      
      loginForm.reset();
      registerForm.reset();
      
      showToast('Logout berhasil!', 'success');
    });
    
    function showMaintenancePage() {
      authPage.classList.add('hidden');
      appPage.classList.add('hidden');
      
      let maintenancePage = document.getElementById('maintenance-page');
      if (!maintenancePage) {
        maintenancePage = document.createElement('div');
        maintenancePage.id = 'maintenance-page';
        maintenancePage.className = 'h-full w-full flex flex-col items-center justify-center p-4 gradient-bg';
        maintenancePage.innerHTML = `
          <div class="glass-card rounded-3xl p-8 text-center max-w-md scale-in">
            <div class="text-6xl mb-4">üîß</div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent mb-3">
              Mode Maintenance
            </h1>
            <p class="text-gray-300 mb-6">Sistem sedang dalam perbaikan. Silakan coba lagi nanti.</p>
            <button id="maintenance-logout" class="bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-500 hover:to-pink-500 text-white font-bold py-3 px-8 rounded-xl transition-all transform hover:scale-105 active:scale-95">
              Logout
            </button>
          </div>
        `;
        document.body.appendChild(maintenancePage);
        
        document.getElementById('maintenance-logout').addEventListener('click', () => {
          logoutBtn.click();
        });
      }
      
      maintenancePage.classList.remove('hidden');
    }

    function showMainApp() {
      authPage.classList.add('hidden');
      appPage.classList.remove('hidden');
      
      loggedUsername.textContent = currentUser.username;
      if (currentUser.isAdmin) {
        userRoleBadge.textContent = 'üëë Admin';
        userRoleBadge.classList.remove('bg-indigo-500/30', 'border-indigo-500/50');
        userRoleBadge.classList.add('bg-yellow-500/30', 'border-yellow-500/50', 'text-yellow-300');
        document.getElementById('admin-nav-btn').classList.remove('hidden');
        document.getElementById('admin-nav-btn').classList.add('flex');
      } else {
        userRoleBadge.textContent = 'üë§ User';
        userRoleBadge.classList.add('bg-indigo-500/30', 'border-indigo-500/50');
        userRoleBadge.classList.remove('bg-yellow-500/30', 'border-yellow-500/50', 'text-yellow-300');
        document.getElementById('admin-nav-btn').classList.add('hidden');
        document.getElementById('admin-nav-btn').classList.remove('flex');
      }
      
      updateProfilePage();
      showPage('home');
      generateQuestion();
    }
    
    function loadAdminPanel() {
      const maintenanceToggle = document.getElementById('maintenance-toggle');
      const rewardInput = document.getElementById('reward-input');
      const minWithdrawalInput = document.getElementById('min-withdrawal-input');
      const cooldownInput = document.getElementById('cooldown-input');
      const zoneIdInput = document.getElementById('zone-id-input');
      
      maintenanceToggle.checked = maintenanceMode;
      rewardInput.value = rewardPerAd;
      minWithdrawalInput.value = minWithdrawal;
      cooldownInput.value = cooldownDuration;
      zoneIdInput.value = monetagZoneId;
      
      renderUserManagement();
      renderWithdrawalRequests();
    }
    
    async function toggleMaintenance() {
      const maintenanceToggle = document.getElementById('maintenance-toggle');
      maintenanceMode = maintenanceToggle.checked;
      saveToLocalStorage();
      showToast(maintenanceMode ? 'Mode maintenance diaktifkan' : 'Mode maintenance dinonaktifkan');
    }
    
    async function saveRewardSettings() {
      const rewardInput = document.getElementById('reward-input');
      const newValue = parseInt(rewardInput.value);
      
      if (newValue < 1) {
        showToast('Poin minimal adalah 1', 'error');
        return;
      }
      
      const saveBtn = document.getElementById('save-reward-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Menyimpan...';
      
      rewardPerAd = newValue;
      saveToLocalStorage();
      showToast('Pengaturan reward berhasil disimpan');
      
      saveBtn.disabled = false;
      saveBtn.textContent = 'Simpan';
    }
    
    async function saveMinWithdrawalSettings() {
      const minWithdrawalInput = document.getElementById('min-withdrawal-input');
      const newValue = parseInt(minWithdrawalInput.value);
      
      if (newValue < 1) {
        showToast('Minimal penarikan harus lebih dari 0', 'error');
        return;
      }
      
      const saveBtn = document.getElementById('save-min-withdrawal-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Menyimpan...';
      
      minWithdrawal = newValue;
      saveToLocalStorage();
      showToast('Minimal penarikan berhasil diperbarui');
      
      saveBtn.disabled = false;
      saveBtn.textContent = 'Simpan';
    }
    
    async function saveCooldownSettings() {
      const cooldownInput = document.getElementById('cooldown-input');
      const newValue = parseInt(cooldownInput.value);
      
      if (newValue < 1) {
        showToast('Hitungan mundur minimal 1 detik', 'error');
        return;
      }
      
      const saveBtn = document.getElementById('save-cooldown-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Menyimpan...';
      
      cooldownDuration = newValue;
      saveToLocalStorage();
      showToast('Hitungan mundur berhasil diperbarui');
      
      saveBtn.disabled = false;
      saveBtn.textContent = 'Simpan';
    }
    
    async function saveZoneIdSettings() {
      const zoneIdInput = document.getElementById('zone-id-input');
      const newValue = zoneIdInput.value.trim();
      
      if (!newValue) {
        showToast('Zone ID tidak boleh kosong', 'error');
        return;
      }
      
      const saveBtn = document.getElementById('save-zone-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Menyimpan...';
      
      monetagZoneId = newValue;
      saveToLocalStorage();
      showToast('Zone ID berhasil diperbarui. Reload halaman untuk menerapkan perubahan.');
      
      saveBtn.disabled = false;
      saveBtn.textContent = 'Simpan';
    }
    
    function renderUserManagement() {
      const container = document.getElementById('user-management-list');
      container.innerHTML = '';
      
      allUsers.forEach(user => {
        if (user.isAdmin) return;
        
        const userCard = document.createElement('div');
        userCard.className = 'bg-black/20 rounded-lg p-3';
        userCard.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-xs font-bold">
                ${user.username.charAt(0).toUpperCase()}
              </div>
              <div>
                <p class="text-white text-sm font-medium">${user.username}</p>
                <p class="text-gray-400 text-xs">${user.coins || 0} koin ‚Ä¢ ${user.adsWatched || 0} iklan</p>
              </div>
            </div>
            <span class="text-xs px-2 py-1 rounded-full ${user.isBlocked ? 'bg-red-500/20 text-red-300' : 'bg-green-500/20 text-green-300'}">
              ${user.isBlocked ? 'üö´ Diblokir' : 'ÔøΩÔøΩÔøΩ Aktif'}
            </span>
          </div>
          <div class="flex gap-2 mt-2">
            <button class="edit-user-btn flex-1 bg-blue-600/30 hover:bg-blue-600/50 text-blue-300 text-xs py-1.5 px-2 rounded transition-all" data-id="${user.__backendId}">
              ‚úèÔ∏è Edit
            </button>
            <button class="block-user-btn flex-1 bg-${user.isBlocked ? 'green' : 'red'}-600/30 hover:bg-${user.isBlocked ? 'green' : 'red'}-600/50 text-${user.isBlocked ? 'green' : 'red'}-300 text-xs py-1.5 px-2 rounded transition-all" data-id="${user.__backendId}">
              ${user.isBlocked ? '‚úÖ Aktifkan' : 'üö´ Blokir'}
            </button>
            <button class="delete-user-btn bg-red-700/40 hover:bg-red-700/60 text-red-200 text-xs py-1.5 px-2 rounded transition-all" data-id="${user.__backendId}">
              üóëÔ∏è
            </button>
          </div>
        `;
        
        container.appendChild(userCard);
      });
      
      document.querySelectorAll('.edit-user-btn').forEach(btn => {
        btn.addEventListener('click', () => openEditUserModal(btn.dataset.id));
      });
      
      document.querySelectorAll('.block-user-btn').forEach(btn => {
        btn.addEventListener('click', () => toggleBlockUser(btn.dataset.id));
      });
      
      document.querySelectorAll('.delete-user-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteUser(btn.dataset.id));
      });
    }
    
    function openEditUserModal(userId) {
      const user = allUsers.find(u => u.__backendId === userId);
      if (!user) return;
      
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full">
          <h3 class="text-xl font-bold text-white mb-4">Edit User: ${user.username}</h3>
          <div class="space-y-3">
            <div>
              <label class="text-gray-300 text-sm block mb-2">Username Baru</label>
              <input type="text" id="edit-username" value="${user.username}" class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
            </div>
            <div>
              <label class="text-gray-300 text-sm block mb-2">Password Baru (kosongkan jika tidak diubah)</label>
              <input type="password" id="edit-password" placeholder="Password baru" class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
            </div>
            <div>
              <label class="text-gray-300 text-sm block mb-2">Poin</label>
              <input type="number" id="edit-coins" value="${user.coins || 0}" min="0" class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
            </div>
            <div class="flex gap-2 mt-4">
              <button id="save-user-btn" class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
                Simpan
              </button>
              <button id="cancel-edit-btn" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
                Batal
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('save-user-btn').addEventListener('click', async () => {
        const newUsername = document.getElementById('edit-username').value.trim();
        const newPassword = document.getElementById('edit-password').value;
        const newCoins = parseInt(document.getElementById('edit-coins').value);
        
        if (newUsername.length < 3) {
          showToast('Username minimal 3 karakter', 'error');
          return;
        }
        
        const usernameExists = allUsers.find(u => u.username === newUsername && u.__backendId !== userId);
        if (usernameExists) {
          showToast('Username sudah digunakan', 'error');
          return;
        }
        
        user.username = newUsername;
        user.coins = newCoins;
        
        if (newPassword) {
          user.password = await hashPassword(newPassword);
        }
        
        const result = await window.dataSdk.update(user);
        if (result.isOk) {
          showToast('User berhasil diupdate');
          modal.remove();
          renderUserManagement();
        } else {
          showToast('Gagal mengupdate user', 'error');
        }
      });
      
      document.getElementById('cancel-edit-btn').addEventListener('click', () => {
        modal.remove();
      });
    }
    
    async function toggleBlockUser(userId) {
      const user = allUsers.find(u => u.__backendId === userId);
      if (!user) return;
      
      user.isBlocked = !user.isBlocked;
      
      const result = await window.dataSdk.update(user);
      if (result.isOk) {
        showToast(user.isBlocked ? 'User berhasil diblokir' : 'User berhasil diaktifkan');
        renderUserManagement();
      } else {
        showToast('Gagal mengubah status user', 'error');
      }
    }
    
    function deleteUser(userId) {
      const user = allUsers.find(u => u.__backendId === userId);
      if (!user) return;
      
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full text-center">
          <div class="text-5xl mb-3">‚ö†ÔøΩÔøΩÔøΩ</div>
          <h3 class="text-xl font-bold text-white mb-2">Hapus User?</h3>
          <p class="text-gray-300 text-sm mb-1">Username: <strong>${user.username}</strong></p>
          <p class="text-gray-400 text-xs mb-4">Akun ini akan dihapus permanen beserta semua datanya</p>
          <div class="flex gap-2">
            <button id="confirm-delete-user-btn" class="flex-1 bg-gradient-to-r from-red-600 to-rose-600 text-white font-bold py-2 px-4 rounded-lg transition-all">
              Hapus
            </button>
            <button id="cancel-delete-user-btn" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
              Batal
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirm-delete-user-btn').addEventListener('click', async () => {
        const result = await window.dataSdk.delete(user);
        if (result.isOk) {
          showToast('User berhasil dihapus');
          modal.remove();
          renderUserManagement();
        } else {
          showToast('Gagal menghapus user', 'error');
        }
      });
      
      document.getElementById('cancel-delete-user-btn').addEventListener('click', () => {
        modal.remove();
      });
    }
    
    function renderWithdrawalRequests() {
      const container = document.getElementById('withdrawal-list');
      const noWithdrawals = document.getElementById('no-withdrawals');
      
      if (withdrawalRequests.length === 0) {
        container.classList.add('hidden');
        noWithdrawals.classList.remove('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      noWithdrawals.classList.add('hidden');
      container.innerHTML = '';
      
      withdrawalRequests.forEach(request => {
        const user = allUsers.find(u => u.__backendId === request.userId);
        const username = user ? user.username : 'Unknown';
        
        const statusColor = request.status === 'pending' ? 'yellow' : request.status === 'approved' ? 'green' : 'red';
        const statusText = request.status === 'pending' ? '‚è≥ Pending' : request.status === 'approved' ? '‚úÖ Diterima' : '‚ùå Ditolak';
        
        const requestCard = document.createElement('div');
        requestCard.className = 'bg-black/20 rounded-lg p-3';
        requestCard.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div>
              <p class="text-white text-sm font-medium">${username}</p>
              <p class="text-gray-400 text-xs">${request.amount} koin</p>
              <p class="text-gray-500 text-xs">${new Date(request.requestedAt).toLocaleDateString('id-ID')}</p>
            </div>
            <span class="text-xs px-2 py-1 rounded-full bg-${statusColor}-500/20 text-${statusColor}-300">
              ${statusText}
            </span>
          </div>
          ${request.adminNote ? `<p class="text-gray-400 text-xs mb-2">üìù ${request.adminNote}</p>` : ''}
          ${request.status === 'pending' ? `
            <div class="flex gap-2 mt-2">
              <button class="approve-request-btn flex-1 bg-green-600/30 hover:bg-green-600/50 text-green-300 text-xs py-1.5 px-2 rounded transition-all" data-id="${request.__backendId}">
                ‚úÖ Terima
              </button>
              <button class="reject-request-btn flex-1 bg-red-600/30 hover:bg-red-600/50 text-red-300 text-xs py-1.5 px-2 rounded transition-all" data-id="${request.__backendId}">
                ‚ùå Tolak
              </button>
            </div>
          ` : `
            <button class="delete-request-btn w-full bg-red-600/30 hover:bg-red-600/50 text-red-300 text-xs py-1.5 px-2 rounded transition-all mt-2" data-id="${request.__backendId}">
              üóëÔøΩÔøΩ Hapus Riwayat
            </button>
          `}
        `;
        
        container.appendChild(requestCard);
      });
      
      document.querySelectorAll('.approve-request-btn').forEach(btn => {
        btn.addEventListener('click', () => processWithdrawal(btn.dataset.id, 'approved'));
      });
      
      document.querySelectorAll('.reject-request-btn').forEach(btn => {
        btn.addEventListener('click', () => processWithdrawal(btn.dataset.id, 'rejected'));
      });
      
      document.querySelectorAll('.delete-request-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteWithdrawal(btn.dataset.id));
      });
    }
    
    function processWithdrawal(requestId, status) {
      const request = withdrawalRequests.find(r => r.__backendId === requestId);
      if (!request) return;
      
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full">
          <h3 class="text-xl font-bold text-white mb-4">${status === 'approved' ? 'ÔøΩÔøΩ Terima' : '‚ùå Tolak'} Permintaan</h3>
          <div class="space-y-3">
            <div>
              <label class="text-gray-300 text-sm block mb-2">Catatan Admin</label>
              <textarea id="admin-note" rows="3" placeholder="Tambahkan catatan..." class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500"></textarea>
            </div>
            <div class="flex gap-2 mt-4">
              <button id="confirm-process-btn" class="flex-1 bg-gradient-to-r from-${status === 'approved' ? 'green' : 'red'}-600 to-${status === 'approved' ? 'emerald' : 'rose'}-600 text-white font-bold py-2 px-4 rounded-lg transition-all">
                Konfirmasi
              </button>
              <button id="cancel-process-btn" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
                Batal
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirm-process-btn').addEventListener('click', async () => {
        const note = document.getElementById('admin-note').value.trim();
        
        request.status = status;
        request.adminNote = note || (status === 'approved' ? 'Permintaan diterima' : 'Permintaan ditolak');
        
        if (status === 'rejected') {
          const user = allUsers.find(u => u.__backendId === request.userId);
          if (user) {
            user.coins = (user.coins || 0) + request.amount;
            await window.dataSdk.update(user);
          }
        }
        
        const result = await window.dataSdk.update(request);
        if (result.isOk) {
          showToast(status === 'approved' ? 'Permintaan diterima' : 'Permintaan ditolak dan poin dikembalikan');
          modal.remove();
          renderWithdrawalRequests();
        } else {
          showToast('Gagal memproses permintaan', 'error');
        }
      });
      
      document.getElementById('cancel-process-btn').addEventListener('click', () => {
        modal.remove();
      });
    }
    
    async function deleteWithdrawal(requestId) {
      const request = withdrawalRequests.find(r => r.__backendId === requestId);
      if (!request) return;
      
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full text-center">
          <div class="text-5xl mb-3">ÔøΩÔøΩÔ∏è</div>
          <h3 class="text-xl font-bold text-white mb-2">Hapus Riwayat?</h3>
          <p class="text-gray-300 text-sm mb-4">Riwayat penukaran ini akan dihapus permanen</p>
          <div class="flex gap-2">
            <button id="confirm-delete-btn" class="flex-1 bg-gradient-to-r from-red-600 to-rose-600 text-white font-bold py-2 px-4 rounded-lg transition-all">
              Hapus
            </button>
            <button id="cancel-delete-btn" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
              Batal
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
        const result = await window.dataSdk.delete(request);
        if (result.isOk) {
          showToast('Riwayat berhasil dihapus');
          modal.remove();
          renderWithdrawalRequests();
        } else {
          showToast('Gagal menghapus riwayat', 'error');
        }
      });
      
      document.getElementById('cancel-delete-btn').addEventListener('click', () => {
        modal.remove();
      });
    }

    function showPage(pageName) {
      document.getElementById('home-page').classList.add('hidden');
      document.getElementById('profile-page').classList.add('hidden');
      document.getElementById('admin-page').classList.add('hidden');
      document.getElementById('withdrawal-page').classList.add('hidden');
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      document.getElementById(pageName + '-page').classList.remove('hidden');
      
      const activeBtn = document.querySelector(`.nav-btn[data-page="${pageName}"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
      }
      
      if (pageName === 'admin' && currentUser && currentUser.isAdmin) {
        loadAdminPanel();
      }
      
      if (pageName === 'withdrawal') {
        loadWithdrawalPage();
      }
    }
    
    function updateProfilePage() {
      document.getElementById('profile-username').textContent = currentUser.username;
      document.getElementById('profile-avatar').textContent = currentUser.username.charAt(0).toUpperCase();
      document.getElementById('profile-role').textContent = currentUser.isAdmin ? 'üëë Admin' : 'üë§ User';
      
      const deviceId = currentUser.__backendId ? currentUser.__backendId.substring(0, 12) + '...' : 'N/A';
      document.getElementById('profile-device').textContent = deviceId;
      
      const date = new Date(currentUser.createdAt);
      const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
      document.getElementById('profile-since').textContent = formattedDate;
    }
    
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const page = btn.getAttribute('data-page');
        showPage(page);
      });
    });
    
    document.getElementById('profile-logout').addEventListener('click', () => {
      logoutBtn.click();
    });
    
    function loadWithdrawalPage() {
      if (currentUser) {
        coins = currentUser.coins || 0;
      }
      document.getElementById('withdrawal-coins').textContent = coins + ' ü™ô';
      document.getElementById('min-withdrawal-text').textContent = `Minimal penarikan: ${minWithdrawal} koin (Rp. ${minWithdrawal})`;
      renderUserWithdrawals();
    }
    
    function renderUserWithdrawals() {
      const container = document.getElementById('user-withdrawal-list');
      const noWithdrawals = document.getElementById('no-user-withdrawals');
      
      const userWithdrawals = withdrawalRequests.filter(w => w.userId === currentUser.__backendId);
      
      if (userWithdrawals.length === 0) {
        container.classList.add('hidden');
        noWithdrawals.classList.remove('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      noWithdrawals.classList.add('hidden');
      container.innerHTML = '';
      
      userWithdrawals.forEach(request => {
        const statusColor = request.status === 'pending' ? 'yellow' : request.status === 'approved' ? 'green' : 'red';
        const statusText = request.status === 'pending' ? '‚è≥ Pending' : request.status === 'approved' ? '‚úÖ Diterima' : '‚ùå Ditolak';
        
        const requestCard = document.createElement('div');
        requestCard.className = 'bg-black/20 rounded-lg p-3';
        requestCard.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div>
              <p class="text-white text-sm font-medium">${request.amount} koin</p>
              <p class="text-gray-400 text-xs">Rp. ${request.amount}</p>
              <p class="text-gray-500 text-xs">${new Date(request.requestedAt).toLocaleDateString('id-ID')}</p>
            </div>
            <span class="text-xs px-2 py-1 rounded-full bg-${statusColor}-500/20 text-${statusColor}-300">
              ${statusText}
            </span>
          </div>
          <div class="text-gray-400 text-xs">
            <p>Akun: ${request.accountName}</p>
            <p>No: ${request.accountNumber}</p>
            ${request.adminNote ? `<p class="mt-1 text-gray-300">üìù ${request.adminNote}</p>` : ''}
          </div>
        `;
        
        container.appendChild(requestCard);
      });
    }
    
    document.getElementById('open-withdrawal-form').addEventListener('click', () => {
      if (coins < minWithdrawal) {
        showToast(`Saldo koin minimal ${minWithdrawal} untuk melakukan penarikan`, 'error');
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="glass-card rounded-2xl p-6 max-w-sm w-full">
          <h3 class="text-xl font-bold text-white mb-4">ÔøΩÔøΩÔøΩÔøΩ Form Penarikan</h3>
          <form id="withdrawal-form" class="space-y-3">
            <div>
              <label class="text-gray-300 text-sm block mb-2">Jumlah Koin (min. ${minWithdrawal})</label>
              <input type="number" id="withdrawal-amount" min="${minWithdrawal}" max="${coins}" value="${minWithdrawal}" class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500" required>
              <p class="text-gray-400 text-xs mt-1">Saldo Anda: ${coins} koin</p>
            </div>
            <div>
              <label class="text-gray-300 text-sm block mb-2">Nama Akun DANA</label>
              <input type="text" id="account-name" placeholder="Nama lengkap" class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500" required>
            </div>
            <div>
              <label class="text-gray-300 text-sm block mb-2">Nomor Akun DANA</label>
              <input type="text" id="account-number" placeholder="08xxxxxxxxxx" class="w-full bg-black/30 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500" required>
            </div>
            <div class="flex gap-2 mt-4">
              <button type="submit" id="submit-withdrawal-btn" class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
                Submit
              </button>
              <button type="button" id="cancel-withdrawal-btn" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition-all">
                Batal
              </button>
            </div>
          </form>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('withdrawal-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const amount = parseInt(document.getElementById('withdrawal-amount').value);
        const accountName = document.getElementById('account-name').value.trim();
        const accountNumber = document.getElementById('account-number').value.trim();
        
        if (amount < minWithdrawal) {
          showToast(`Minimal penarikan adalah ${minWithdrawal} koin`, 'error');
          return;
        }
        
        if (amount > coins) {
          showToast('Saldo koin tidak mencukupi', 'error');
          return;
        }
        
        const submitBtn = document.getElementById('submit-withdrawal-btn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Memproses...';
        
        const newWithdrawal = {
          type: 'withdrawal',
          userId: currentUser.__backendId,
          amount: amount,
          accountName: accountName,
          accountNumber: accountNumber,
          status: 'pending',
          adminNote: '',
          requestedAt: new Date().toISOString()
        };
        
        const result = await window.dataSdk.create(newWithdrawal);
        
        if (result.isOk) {
          coins -= amount;
          currentUser.coins = coins;
          await window.dataSdk.update(currentUser);
          
          updateStats();
          showToast('Permintaan penarikan berhasil dikirim!');
          modal.remove();
          loadWithdrawalPage();
          
          setTimeout(() => {
            showInterstitialAd();
          }, 500);
        } else {
          showToast('Gagal mengirim permintaan penarikan', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit';
        }
      });
      
      document.getElementById('cancel-withdrawal-btn').addEventListener('click', () => {
        modal.remove();
      });
    });

    function generateQuestion() {
      const num1 = Math.floor(Math.random() * 100) + 1;
      const num2 = Math.floor(Math.random() * 100) + 1;
      correctAnswer = num1 + num2;
      
      quizQuestion.textContent = `${num1} + ${num2} = ?`;
      
      const wrongAnswers = [];
      while (wrongAnswers.length < 3) {
        const wrong = correctAnswer + (Math.floor(Math.random() * 20) - 10);
        if (wrong !== correctAnswer && wrong > 0 && !wrongAnswers.includes(wrong)) {
          wrongAnswers.push(wrong);
        }
      }
      
      const allAnswers = [correctAnswer, ...wrongAnswers];
      
      for (let i = allAnswers.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allAnswers[i], allAnswers[j]] = [allAnswers[j], allAnswers[i]];
      }
      
      answerBtns.forEach((btn, index) => {
        btn.textContent = allAnswers[index];
        btn.disabled = false;
        btn.classList.remove('correct', 'wrong');
      });
    }

    answerBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const selectedAnswer = parseInt(btn.textContent);
        const isCorrect = selectedAnswer === correctAnswer;
        
        answerBtns.forEach(b => b.disabled = true);
        
        if (isCorrect) {
          btn.classList.add('correct');
          showToast('Jawaban Benar! ‚úÖ', 'success');
          
          setTimeout(() => {
            enableAdButton();
          }, 1000);
        } else {
          btn.classList.add('wrong');
          showToast('Jawaban Salah! ‚ùå', 'error');
          
          setTimeout(() => {
            generateQuestion();
          }, 1500);
        }
      });
    });

    function enableAdButton() {
      canWatchAd = true;
      watchAdBtn.disabled = false;
      watchAdBtn.classList.remove('bg-gradient-to-r', 'from-gray-600', 'to-gray-700', 'opacity-50', 'cursor-not-allowed');
      watchAdBtn.classList.add('bg-gradient-to-r', 'from-indigo-600', 'to-purple-600', 'hover:from-indigo-500', 'hover:to-purple-500', 'ad-button');
    }

    function disableAdButton() {
      canWatchAd = false;
      watchAdBtn.disabled = true;
      watchAdBtn.classList.remove('bg-gradient-to-r', 'from-indigo-600', 'to-purple-600', 'hover:from-indigo-500', 'hover:to-purple-500', 'ad-button');
      watchAdBtn.classList.add('bg-gradient-to-r', 'from-gray-600', 'to-gray-700', 'opacity-50', 'cursor-not-allowed');
    }

    function showInterstitialAd() {
      if (typeof window.invoke_9865183 === 'function') {
        console.log('Showing Monetag Interstitial for withdrawal...');
        try {
          window.invoke_9865183();
          console.log('Withdrawal ad invoked!');
        } catch (error) {
          console.error('Withdrawal ad error:', error);
        }
      } else {
        console.warn('Monetag not available');
      }
    }

    function isMobileBrowser() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());
    }
    
    function getBrowserInfo() {
      const ua = navigator.userAgent;
      let browserName = 'Unknown';
      
      if (ua.indexOf('Chrome') > -1 && ua.indexOf('Edg') === -1) browserName = 'Chrome';
      else if (ua.indexOf('Safari') > -1 && ua.indexOf('Chrome') === -1) browserName = 'Safari';
      else if (ua.indexOf('Firefox') > -1) browserName = 'Firefox';
      else if (ua.indexOf('Edg') > -1) browserName = 'Edge';
      else if (ua.indexOf('Opera') > -1 || ua.indexOf('OPR') > -1) browserName = 'Opera';
      
      return {
        isMobile: isMobileBrowser(),
        name: browserName,
        userAgent: ua
      };
    }

    function watchAd() {
      if (!canWatchAd || cooldownActive) return;
      
      const browserInfo = getBrowserInfo();
      console.log('üîç Browser Info:', browserInfo);
      
      watchAdBtn.disabled = true;
      loadingOverlay.classList.remove('hidden');
      
      const timeoutDuration = browserInfo.isMobile ? 15000 : 8000;
      const checkInterval = browserInfo.isMobile ? 1000 : 500;
      const maxChecks = browserInfo.isMobile ? 25 : 15;
      
      console.log(`üì± Mobile: ${browserInfo.isMobile} | Timeout: ${timeoutDuration}ms | Interval: ${checkInterval}ms | Max: ${maxChecks}`);
      
      let adShown = false;
      let checkCount = 0;
      
      const checkAdReady = setInterval(() => {
        checkCount++;
        const prefix = browserInfo.isMobile ? 'üì±[Mobile]' : 'üñ•Ô∏è[Desktop]';
        console.log(`${prefix} Check ${checkCount}/${maxChecks} - Looking for invoke function...`);
        
        if (typeof window.invoke_9865183 === 'function') {
          clearInterval(checkAdReady);
          adShown = true;
          console.log('‚úÖ Monetag invoke found!');
          
          try {
            console.log('üé¨ Invoking ad...');
            window.invoke_9865183();
            console.log('‚úÖ Ad invoked successfully!');
            
            const adDisplayDelay = browserInfo.isMobile ? 4000 : 2500;
            console.log(`‚è±Ô∏è Waiting ${adDisplayDelay}ms for ad display...`);
            
            setTimeout(() => {
              loadingOverlay.classList.add('hidden');
              console.log('‚úÖ Ad completed, giving reward');
              onAdComplete();
            }, adDisplayDelay);
            
          } catch (error) {
            console.error('‚ùå Ad invoke error:', error);
            loadingOverlay.classList.add('hidden');
            onAdComplete();
          }
          
        } else if (checkCount >= maxChecks) {
          clearInterval(checkAdReady);
          console.warn(`‚ö†Ô∏è Max checks (${maxChecks}) reached, Monetag not available`);
          
          if (!adShown) {
            console.log('‚ö†Ô∏è No ad shown, but giving reward anyway');
            loadingOverlay.classList.add('hidden');
            onAdComplete();
          }
        }
      }, checkInterval);
      
      setTimeout(() => {
        if (!adShown) {
          clearInterval(checkAdReady);
          console.warn(`‚è∞ Timeout (${timeoutDuration}ms) reached`);
          loadingOverlay.classList.add('hidden');
          
          if (typeof window.invoke_9865183 === 'function') {
            console.log('üîÑ Last attempt to invoke ad...');
            try {
              window.invoke_9865183();
              setTimeout(() => {
                console.log('‚úÖ Final ad attempt completed');
                onAdComplete();
              }, 3000);
            } catch (error) {
              console.error('‚ùå Final attempt error:', error);
              onAdComplete();
            }
          } else {
            console.log('‚ö†Ô∏è Timeout with no ad, giving reward');
            onAdComplete();
          }
        }
      }, timeoutDuration);
    }
    
    function onAdComplete() {
      coins += rewardPerAd;
      adsWatched += 1;
      
      if (currentUser) {
        currentUser.coins = coins;
        currentUser.adsWatched = adsWatched;
        window.dataSdk.update(currentUser);
      }
      
      updateStats();
      document.getElementById('reward-message').textContent = `Kamu mendapatkan +${rewardPerAd} koin!`;
      rewardPopup.classList.remove('hidden');
      
      if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
      }
    }

    function updateStats() {
      coinDisplay.textContent = coins + ' ü™ô';
      
      if (currentUser && !document.getElementById('profile-page').classList.contains('hidden')) {
        updateProfilePage();
      }
    }

    function updateRewardDisplay() {
      const rewardDisplay = document.getElementById('reward-per-ad-display');
      if (rewardDisplay) {
        rewardDisplay.textContent = `+${rewardPerAd} ü™ô`;
      }
    }

    function startCooldown() {
      cooldownActive = true;
      cooldownTime = cooldownDuration;
      cooldownContainer.classList.remove('hidden');
      disableAdButton();
      
      const interval = setInterval(() => {
        cooldownTime--;
        const minutes = Math.floor(cooldownTime / 60);
        const seconds = cooldownTime % 60;
        cooldownTimer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        
        if (cooldownTime <= 0) {
          clearInterval(interval);
          cooldownActive = false;
          cooldownContainer.classList.add('hidden');
          generateQuestion();
        }
      }, 1000);
    }

    function closePopup() {
      rewardPopup.classList.add('hidden');
      startCooldown();
      
      if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
      }
    }

    watchAdBtn.addEventListener('click', () => {
      if (!watchAdBtn.disabled && canWatchAd) {
        watchAd();
      }
    });
    
    closePopupBtn.addEventListener('click', closePopup);
    
    document.addEventListener('DOMContentLoaded', () => {
      const maintenanceToggle = document.getElementById('maintenance-toggle');
      if (maintenanceToggle) {
        maintenanceToggle.addEventListener('change', toggleMaintenance);
      }
      
      const saveRewardBtn = document.getElementById('save-reward-btn');
      if (saveRewardBtn) {
        saveRewardBtn.addEventListener('click', saveRewardSettings);
      }
      
      const saveMinWithdrawalBtn = document.getElementById('save-min-withdrawal-btn');
      if (saveMinWithdrawalBtn) {
        saveMinWithdrawalBtn.addEventListener('click', saveMinWithdrawalSettings);
      }
      
      const saveCooldownBtn = document.getElementById('save-cooldown-btn');
      if (saveCooldownBtn) {
        saveCooldownBtn.addEventListener('click', saveCooldownSettings);
      }
      
      const saveZoneBtn = document.getElementById('save-zone-btn');
      if (saveZoneBtn) {
        saveZoneBtn.addEventListener('click', saveZoneIdSettings);
      }
    });

    async function onConfigChange(config) {
      const title = config.app_title || defaultConfig.app_title;
      const reward = config.reward_text || defaultConfig.reward_text;
      const button = config.button_text || defaultConfig.button_text;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      
      appTitle.textContent = title;
      rewardMessage.textContent = reward;
      buttonLabel.textContent = button;
      
      document.body.style.fontFamily = `${fontFamily}, Poppins, sans-serif`;
      document.body.style.fontSize = `${fontSize}px`;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['reward_text', config.reward_text || defaultConfig.reward_text],
        ['button_text', config.button_text || defaultConfig.button_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    initDataSDK();
    updateStats();
    updateRewardDisplay();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c65801dd6bee77e',t:'MTc2OTgyMzYyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
